00001B00 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 09/01/2022 15:12:26

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : GAME OF LIFE APPLICATION
00000000                             3  ; AUTHOR   : ANTONI BURGUERA
00000000                             4  ; CREATION : 05-JULY-2021
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; TITLE    : SYSTEM CONSTANTS
00001000                            14  ; AUTHOR   : ANTONI BURGUERA
00001000                            15  ; HISTORY  : 05-JULY-2021 - CREATION
00001000                            16  ; COMMENTS : * MOUVAL AND MOUEDGE FORMAT IS AS FOLLOWS:
00001000                            17  ;              +---+---+---+---+---+---+---+---+
00001000                            18  ;              | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            19  ;              +---+---+---+---+---+---+---+---+
00001000                            20  ;              \-------------------/ |   |   |
00001000                            21  ;                        |           |   |   +-- LEFT MOUSE BUTTON
00001000                            22  ;                        |           |   +------ RIGHT MOUSE BUTTON
00001000                            23  ;                        |           +---------- CENTRAL MOUSE BUTTON
00001000                            24  ;                        +---------------------- 0
00001000                            25  ;              A "1" IN ONE OF THESE BITS IN MOUVAL MEANS "BUTTON PRESSED".
00001000                            26  ;              A "0" IN ONE OF THESE BITS IN MOUVAL MEANS "BUTTON NOT PRESSED".
00001000                            27  ;              A "1" IN ONE OF THESE BITS IN MOUEDGE MEANS "BUTTON CLICKED".
00001000                            28  ;              A "0" IN ONE OF THESE BITS IN MOUEDGE MEANS "BUTTON NOT CLICKED".
00001000                            29  ;              A "CLICK" IS A CHANGE FROM 0 TO 1 IN SUBSEQUENT UPDATES.
00001000                            30  ;              BOTH MOUVEL AND MOUEDGE ARE UPDATED BY TRAP #MOUTRAP
00001000                            31  ;
00001000                            32  ;            * MASKS AND BIT POSITIONS ARE DEFINED TO EASE MOUSE ACCESS. FOR
00001000                            33  ;              EXAMPLE, ONE CAN DO THE FOLLOWING TO CHECK IF THE LEFT BUTTON
00001000                            34  ;              IS PRESSED:
00001000                            35  ;
00001000                            36  ;              BTST.L #MOUBITLF,(MOUVAL)
00001000                            37  ;              BNE ...
00001000                            38  ;
00001000                            39  ;              ALTERNATIVELY, ONE CAN ALSO DO THE FOLLOWING DEPENDING ON THE
00001000                            40  ;              CONTEXT:
00001000                            41  ;
00001000                            42  ;              MOVE.B  (MOUVAL),D0
00001000                            43  ;              AND.B   #MOUMSKLF,D0
00001000                            44  ;              BNE ...
00001000                            45  ; =============================================================================
00001000                            46  
00001000                            47  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            48  
00001000  =00000000                 49  SCRTRAP     EQU     0                       ; SCREEN REFRESH TRAP NUMBER
00001000  =00000320                 50  SCRWIDTH    EQU     800                     ; SCREEN WIDTH (PIXELS)
00001000  =00000258                 51  SCRHEIGH    EQU     600                     ; SCREEN HEIGHT (PIXELS)
00001000                            52  
00001000                            53  ; --- MOUSE RELATED CONSTANTS -------------------------------------------------
00001000                            54  
00001000  =00000001                 55  MOUTRAP     EQU     1                       ; MOUSE QUERY TRAP NUMBER
00001000  =00000001                 56  MOUMSKLF    EQU     %00000001               ; LEFT MOUSE BUTTON MASK
00001000  =00000002                 57  MOUMSKRT    EQU     %00000010               ; RIGHT MOUSE BUTTON MASK
00001000  =00000004                 58  MOUMSKMD    EQU     %00000100               ; MIDDLE MOUSE BUTTON MASL
00001000  =00000000                 59  MOUBITLF    EQU     0                       ; LEFT MOUSE BUTTON BIT POSITION
00001000  =00000001                 60  MOUBITRT    EQU     1                       ; RIGHT MOUSE BUTTON BIT POSITION
00001000  =00000002                 61  MOUBITMD    EQU     2                       ; MIDDLE MOUSE BUTTON BIT POSITION
00001000  =00000002                 62  -------------------- end include --------------------
00001000                            63              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            64  ; =============================================================================
00001000                            65  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            66  ; AUTHOR   : ANTONI BURGUERA
00001000                            67  ; HISTORY  : 05-JULY-2021 - CREATION
00001000                            68  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00001000                            69  ;            - SYS : GENERIC.
00001000                            70  ;            - SCR : SCREEN MANAGEMENT.
00001000                            71  ;            - MOU : MOUSE MANAGEMENT
00001000                            72  ;            THE FORMAT OF MOUVAL AND MOUEDGE IS DESCRIBED IN SYSCONST.
00001000                            73  ; =============================================================================
00001000                            74  
00001000                            75  ; -----------------------------------------------------------------------------
00001000                            76  SYSINIT
00001000                            77  ; INITIALIZES THE SYSTEM AS FOLLOWS:
00001000                            78  ; * DISABLES INTERRUPTS
00001000                            79  ; * CALLS SCRINIT
00001000                            80  ; * CALLS MOUINIT
00001000                            81  ; * ENABLES SIMULATOR EXCEPTION PROCESSING
00001000                            82  ; * SWITCHES TO USER
00001000                            83  ; INPUT    - NONE
00001000                            84  ; OUTPUT   - NONE
00001000                            85  ; MODIFIES - NONE
00001000                            86  ; NOTE     - NOTE THAT INTERRUPTS REMAIN DISABLED AFTER THIS SUBROUTINE
00001000                            87  ; -----------------------------------------------------------------------------
00001000                            88  
00001000                            89  ; TODO : PLACE YOUR CODE HERE
00001000  40E7                      90      MOVE.W SR,-(A7)
00001002                            91      
00001002  0257 DFFF                 92      AND.W    #$DFFF,(A7)
00001006                            93      ;Desabilitamos interrupciones
00001006  0057 0700                 94      ORI.W    #$0700,(A7)
0000100A                            95      ;Guardamos los registros
0000100A  48E7 C000                 96      MOVEM.L D0-D1,-(A7)
0000100E                            97      
0000100E                            98      
0000100E                            99      
0000100E                           100      ;Llamamos a las subrutinas
0000100E  4EB9 000010B8            101      JSR SCRINIT
00001014  4EB9 0000102A            102      JSR MOUINIT
0000101A                           103      
0000101A                           104      ;activamos el simulador de excepciones
0000101A  103C 0020                105      MOVE.B #32,D0
0000101E  123C 0005                106      MOVE.B #5,D1
00001022  4E4F                     107      TRAP #15
00001024                           108      
00001024                           109      ;cambiamos a modo usuario
00001024                           110      
00001024  4CDF 0003                111      MOVEM.L (A7)+,D0-D1
00001028  4E73                     112      RTE
0000102A                           113  
0000102A                           114  
0000102A                           115  
0000102A                           116  
0000102A                           117  
0000102A                           118  
0000102A                           119  
0000102A                           120  
0000102A                           121  ; =============================================================================
0000102A                           122  ; MOUSE MANAGEMENT (SYSTEM CODE)
0000102A                           123  ; =============================================================================
0000102A                           124  
0000102A                           125  ; -----------------------------------------------------------------------------
0000102A                           126  MOUINIT
0000102A                           127  ; INITIALIZES MOUSE AS FOLLOWS:
0000102A                           128  ; * STORES CURRENT MOUSE POSITION AND BUTTON STATUS INTO MOUY, MOUX AND MOUVAL
0000102A                           129  ; * CLEARS MOUEDGE
0000102A                           130  ; * INSTALLS MOUREAD INTO TRAP #MOUTRAP
0000102A                           131  ; INPUT    - NONE
0000102A                           132  ; OUTPUT   - NONE
0000102A                           133  ; MODIFIES - ALL REGISTERS CAN BE MODIFIED
0000102A                           134  ; -----------------------------------------------------------------------------
0000102A                           135  
0000102A                           136  ; TODO : PLACE YOUR CODE HERE
0000102A                           137  
0000102A                           138      ;Guardamos los registros
0000102A  48E7 C000                139      MOVEM.L D0-D1,-(A7)
0000102E                           140  
0000102E                           141      ;Posición actual del mouse        
0000102E  103C 003D                142      MOVE.B #61,D0
00001032  4201                     143      CLR.B D1
00001034  4E4F                     144      TRAP #15
00001036                           145      
00001036                           146      ;Guardamos los valores
00001036  23C1 00001B1A            147      MOVE.L  D1,(MOUY)
0000103C                           148      
0000103C  13C0 00001B1E            149      MOVE.B D0,(MOUVAL)
00001042                           150      
00001042                           151      ;Reestablecemos MOUEDGE
00001042  13FC 0000 00001B1F       152      MOVE.B #0,(MOUEDGE)
0000104A                           153      
0000104A                           154      ;Instalamos MOUTRAP 
0000104A  21FC 00001058 0084       155      MOVE.L  #MOUREAD,($80+MOUTRAP*4)
00001052                           156      
00001052  4CDF 0003                157      MOVEM.L (A7)+,D0-D1
00001056  4E75                     158      RTS
00001058                           159  
00001058                           160  ; -----------------------------------------------------------------------------
00001058                           161  MOUREAD
00001058                           162  ; MOUSE READING TRAP SERVICE ROUTINE. IT DOES THE FOLLOWING:
00001058                           163  ; * STORES CURRENT MOUSE POSITION INTO MOUY AND MOUX.
00001058                           164  ; * STORES CURRENT BUTTON STATUS INTO MOUVAL
00001058                           165  ; * COMPUTES AND STORES MOUEDGE
00001058                           166  ; INPUT    - NONE
00001058                           167  ; OUTPUT   - NONE
00001058                           168  ; MODIFIES - NONE
00001058                           169  ; -----------------------------------------------------------------------------
00001058                           170  
00001058                           171  ; TODO : PLACE YOUR CODE HERE
00001058                           172  
00001058                           173      ;Guardamos los registros
00001058  48E7 F000                174      MOVEM.L  D0-D3,-(A7)
0000105C                           175                      
0000105C                           176      ;Posición actual del mouse        
0000105C  103C 003D                177      MOVE.B #61,D0
00001060  4201                     178      CLR.B D1
00001062  4E4F                     179      TRAP #15
00001064                           180      
00001064                           181      ;Almacenamos X,Y del mouse
00001064  23C1 00001B1A            182      MOVE.L  D1,(MOUY)
0000106A                           183      
0000106A                           184      ;Almacenamos el estado de los botones en MOUVAL
0000106A  13C0 00001B1E            185      MOVE.B D0,(MOUVAL)
00001070                           186      
00001070                           187      ;Almacenamos MOUEDGE
00001070  C03C 0001                188      AND.B  #MOUMSKLF,D0
00001074  6600 0018                189      BNE  .CERO  
00001078                           190      
00001078  C03C 0002                191      AND.B #MOUMSKRT,D0
0000107C  6600 001E                192      BNE .UNO
00001080                           193      
00001080  C03C 0004                194      AND.B #MOUMSKMD,D0
00001084  6600 0024                195      BNE .DOS
00001088                           196      
00001088  4EF9 000010B2            197      JMP .END
0000108E                           198      
0000108E                           199  .CERO: 
0000108E  0239 0001 00001B1F       200        AND.B #MOUMSKLF,(MOUEDGE)
00001096  4EF9 000010B2            201        JMP .END
0000109C                           202  .UNO:
0000109C  0239 0002 00001B1F       203        AND.B #MOUMSKRT,(MOUEDGE)
000010A4  4EF9 000010B2            204        JMP .END
000010AA                           205  
000010AA  0239 0004 00001B1F       206  .DOS: AND.B #MOUMSKMD,(MOUEDGE)
000010B2                           207  
000010B2  4CDF 000F                208  .END: MOVEM.L (A7)+,D0-D3
000010B6  4E73                     209        RTE     
000010B8                           210  
000010B8                           211  
000010B8                           212  
000010B8                           213  
000010B8                           214  
000010B8                           215  
000010B8                           216  
000010B8                           217  
000010B8                           218  
000010B8                           219  
000010B8                           220  
000010B8                           221  
000010B8                           222  
000010B8                           223  ; =============================================================================
000010B8                           224  ; SCREEN MANAGEMENT (SYSTEM CODE)
000010B8                           225  ; =============================================================================
000010B8                           226  
000010B8                           227  ; -----------------------------------------------------------------------------
000010B8                           228  SCRINIT
000010B8                           229  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS AS FOLLOWS:
000010B8                           230  ; * INSTALLS SCRUPD INTO TRAP #SCRTRAP
000010B8                           231  ; * SETS OUTPUT RESOLUTION TO SCRWIDTH*SCRHEIGH
000010B8                           232  ; * SETS OUTPUT TO WINDOWED MODE
000010B8                           233  ; * ENABLES DOUBLE BUFFER AND CLEARS BOTH SCREEN BUFFERS
000010B8                           234  ; INPUT    - NONE
000010B8                           235  ; OUTPUT   - NONE
000010B8                           236  ; MODIFIES - ALL REGISTERS CAN BE MODIFIED
000010B8                           237  ; -----------------------------------------------------------------------------
000010B8  21FC 000010F0 0080       238              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; INSTALL TRAP
000010C0  223C 03200258            239              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; SET RESOLUTION
000010C6  103C 0021                240              MOVE.B  #33,D0
000010CA  4E4F                     241              TRAP    #15
000010CC  7201                     242              MOVE.L  #1,D1                   ; SET WINDOWED MODE
000010CE  4E4F                     243              TRAP    #15
000010D0  323C FF00                244              MOVE.W  #$FF00,D1               ; CLEAR VISIBLE BUFFER
000010D4  103C 000B                245              MOVE.B  #11,D0
000010D8  4E4F                     246              TRAP    #15
000010DA  123C 0011                247              MOVE.B  #17,D1                  ; ENABLE DOUBLE BUFFER
000010DE  103C 005C                248              MOVE.B  #92,D0
000010E2  4E4F                     249              TRAP    #15
000010E4  323C FF00                250              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010E8  103C 000B                251              MOVE.B  #11,D0
000010EC  4E4F                     252              TRAP    #15
000010EE  4E75                     253              RTS
000010F0                           254  
000010F0                           255  ; -----------------------------------------------------------------------------
000010F0                           256  SCRUPD
000010F0                           257  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
000010F0                           258  ; BUFFER FOR THE NEXT ONE. PERFORMS TWO TASKS:
000010F0                           259  ; * CLEARS ACTIVE (HIDDEN) GRAPHICS BUFFER
000010F0                           260  ; * SWITCHES ACTIVE AND VISIBLE GRAPHICS BUFFER
000010F0                           261  ; INPUT    - NONE
000010F0                           262  ; OUTPUT   - NONE
000010F0                           263  ; MODIFIES - NONE
000010F0                           264  ; -----------------------------------------------------------------------------
000010F0  48A7 C000                265              MOVEM.W D0-D1,-(A7)
000010F4  103C 005E                266              MOVE.B  #94,D0                  ; UPDATE DOUBLE BUFFER
000010F8  4E4F                     267              TRAP    #15
000010FA  323C FF00                268              MOVE.W  #$FF00,D1               ; CLEAR HIDDEN BUFFER
000010FE  103C 000B                269              MOVE.B  #11,D0
00001102  4E4F                     270              TRAP    #15
00001104  4C9F 0003                271              MOVEM.W (A7)+,D0-D1
00001108  4E73                     272              RTE
0000110A                           273  
0000110A                           274  
0000110A                           275  
0000110A                           276  
0000110A                           277  
0000110A                           278  
0000110A                           279  
0000110A                           280  
0000110A                           281  -------------------- end include --------------------
0000110A                           282              INCLUDE "CONST.X68"             ; USER CONSTANTS
0000110A                           283  ; =============================================================================
0000110A                           284  ; TITLE    : USER CONSTANTS
0000110A                           285  ; AUTHOR   : ANTONI BURGUERA
0000110A                           286  ; HISTORY  : 05-JULY-2021 - CREATION
0000110A                           287  ; COMMENTS : * MOST OF THE CONSTANTS HELP IN PRODUCING A CLEAN CODE
0000110A                           288  ;              IN ACCORDANCE TO THE ASSIGNMENT SPECS, THOUGH THEIR USE IS
0000110A                           289  ;              NOT MANDATORY AS LONG AS THE ASSIGNMENT SPECS ARE FOLLOWED.
0000110A                           290  ;
0000110A                           291  ;            * THE UICOLORS ARE THE BASIC USER INTERFACE COLORS. USING THEM
0000110A                           292  ;              WILL LEAD TO A VISUALLY CONSISTENT USER INTERFACE.
0000110A                           293  ;
0000110A                           294  ;            * THE CHARACTER SIZES SPECIFY WIDTH AND HEIGHT IN PIXELS OF THE
0000110A                           295  ;              TEXT CHARACTERS. THIS SIZE DEPENDS ON THE SYSTEM (WINDOWS) FONTS
0000110A                           296  ;              AND CAN CHANGE FROM ONE COMPUTER TO ANOTHER. FEEL FREE TO ADAPT
0000110A                           297  ;              THEM TO YOUR OWN COMPUTER.
0000110A                           298  ;
0000110A                           299  ;            * CHARACTER SIZES ARE SPECIFIED AS AN EXPONENT AND THE SIZE ITSELF
0000110A                           300  ;              THE EXPONENT IS USEFUL TO MULTIPLY/DIVIDE, WHEN NECESSARY,
0000110A                           301  ;              USING SHIFTS. DEPENDING ON YOUR SYSTEM (WINDOWS) FONTS, CHAR
0000110A                           302  ;              SIZES MAY NOT BE POWER OF TWO. IF THIS IS THE CASE, DO YOUR BEST
0000110A                           303  ;              TO AVOID MULU AND DIVU.
0000110A                           304  ;
0000110A                           305  ;            * MOST OF THE GRD CONSTANTS ARE EXPRESSIONS TO EASE TESTING
0000110A                           306  ;              DIFFERENT RESOLUTIONS. IF TESTS WITH OTHER RESOLUTIONS ARE
0000110A                           307  ;              PERFORMED, TAKE INTO ACCOUNT THAT ALL EXPRESSIONS MUST EVALUATE
0000110A                           308  ;              TO INTEGER. IF THEY DON'T, UNEXPECTED RESULTS CAN HAPPEN.
0000110A                           309  ; =============================================================================
0000110A                           310  
0000110A                           311  ; --- UI COLORS ---------------------------------------------------------------
0000110A                           312  
0000110A  =00000000                313  CLRBLACK    EQU     $00000000               ; BLACK
0000110A  =00FFFFFF                314  CLRWHITE    EQU     $00FFFFFF               ; WHITE
0000110A  =00005500                315  CLRDKGRN    EQU     $00005500               ; DARK GREEN
0000110A  =00006600                316  CLRMDGRN    EQU     $00006600               ; MEDIUN GREEN
0000110A  =0000AA00                317  CLRLTGRN    EQU     $0000AA00               ; LIGHT GREEN
0000110A  =00FF0000                318  CLRLTBLU    EQU     $00FF0000               ; LIGHT BLUE
0000110A  =000000FF                319  CLRLTRED    EQU     $000000FF               ; LIGHT RED
0000110A                           320  
0000110A                           321  ; --- CHARACTER SIZES ---------------------------------------------------------
0000110A                           322  
0000110A  =00000004                323  CHRSHHEI    EQU     4                       ; CHARACTER HEIGHT AS EXPONENT OF 2
0000110A  =00000003                324  CHRSHWID    EQU     3                       ; CHARACTER WIDTH AS EXPONENT OF 2
0000110A  =00000010                325  CHRHEIGH    EQU     1<<CHRSHHEI             ; CHARACTER HEIGHT
0000110A  =00000008                326  CHRWIDTH    EQU     1<<CHRSHWID             ; CHARACTER WIDTH
0000110A                           327  
0000110A                           328  ; --- BUTTON ------------------------------------------------------------------
0000110A                           329  
0000110A  =00000004                330  BTNPENWD    EQU     4                       ; BUTTON LINE WIDTH
0000110A  =00005500                331  BTNPENCL    EQU     CLRDKGRN                ; BUTTON LINE COLOR
0000110A  =0000AA00                332  BTNSELCL    EQU     CLRLTGRN                ; BUTTON SELECTED FILL COLOR
0000110A  =00006600                333  BTNPRSCL    EQU     CLRMDGRN                ; BUTTON PRESSED FILL COLOR
0000110A  =00000006                334  BTNSZVDB    EQU     6                       ; SIZE (BYTES) OF VDB
0000110A                           335  
0000110A                           336  ; --- BUTTON LIST -------------------------------------------------------------
0000110A                           337  
0000110A  =0000000A                338  BTLMXVDB    EQU     10                      ; SIZE OF THE BUTTON LIST (ITEMS)
0000110A  =00000028                339  BTLVERSZ    EQU     40                      ; HEIGHT OF BUTTONS
0000110A  =0000000A                340  BTLVEMRG    EQU     10                      ; VERTICAL VISUAL MARGIN (TOP&BOT)
0000110A  =0000000A                341  BTLHOMRG    EQU     10                      ; HORIZONTAL VISUAL MARGIN (L & R)
0000110A                           342  
0000110A                           343  ; --- APPLICATION -------------------------------------------------------------
0000110A                           344  
0000110A  =00000000                345  GOLSPAUS    EQU     0                       ; PAUSED STATE
0000110A  =00000001                346  GOLSEXEC    EQU     1                       ; EXECUTION STATE
0000110A  =000000FA                347  GOLMAXGN    EQU     250                     ; MAXIMUM NUMBER OF GENERATIONS
0000110A                           348  
0000110A                           349  ; --- GRID --------------------------------------------------------------------
0000110A                           350  
0000110A  =00FF0000                351  GRDCOLP1    EQU     CLRLTBLU                ; PLAYER 1 COLOR
0000110A  =000000FF                352  GRDCOLP2    EQU     CLRLTRED                ; PLAYER 2 COLOR
0000110A  =00000006                353  GRDSHWID    EQU     6                       ; SHIFT TO ACHIEVE GRDWIDTH
0000110A  =00000005                354  GRDSHHEI    EQU     5                       ; SHIFT TO ACHIEVE GRDHEIGH
0000110A  =00000040                355  GRDWIDTH    EQU     1<<GRDSHWID             ; NUMBER OF GRID COLUMNS
0000110A  =00000020                356  GRDHEIGH    EQU     1<<GRDSHHEI             ; NUMBER OF ROWS
0000110A  =0000003F                357  GRDMSWID    EQU     GRDWIDTH-1              ; MASK TO GET X FROM GRID OFFSET
0000110A  =0000001F                358  GRDMSHEI    EQU     GRDHEIGH-1              ; MASK TO GET Y FROM GRID OFFSET
0000110A  =00000300                359  GRDPXWID    EQU     768                     ; GRID DISPLAY WIDTH (PIXELS)
0000110A  =00000180                360  GRDPXHEI    EQU     GRDHEIGH*GRDPXWID/GRDWIDTH ; GRID DISPLAY HEIGHT (PIXELS)
0000110A  =0000000C                361  GRDSZCEL    EQU     GRDPXWID/GRDWIDTH       ; GRID CELL SIZE (PIXELS)
0000110A  =0000006E                362  GRDVEMRG    EQU     3*BTLVEMRG+2*BTLVERSZ   ; TOP MARGIN (2 BUTTON ROWS)
0000110A  =00000010                363  GRDXOFF     EQU     (SCRWIDTH-GRDPXWID)/2   ; X OFFSETS TO DISPLAY CENTERED GRID
0000110A  =0000009E                364  GRDYOFF     EQU     (SCRHEIGH-GRDPXHEI+GRDVEMRG-BTLVEMRG)/2 ; Y OFFSET CENT. GRD
0000110A  =00000002                365  GRDSCP1X    EQU     GRDXOFF/CHRWIDTH        ; PLAYER 1 SCORE X (CHAR RESOL.)
0000110A  =00000009                366  GRDSCP1Y    EQU     GRDYOFF/CHRHEIGH        ; PLAYER 1 SCORE Y (CHAR RESOL.)
0000110A  =0000005E                367  GRDSCP2X    EQU     (GRDXOFF+GRDPXWID)/CHRWIDTH-4 ; PLAYER 2 SCORE X (CHAR RES.)
0000110A  =00000009                368  GRDSCP2Y    EQU     GRDYOFF/CHRHEIGH        ; PLAYER 2 SCORE Y (CHAR RESOL.)
0000110A  =00000030                369  GRDSCNGX    EQU     (SCRWIDTH/(CHRWIDTH*2))-2 ; NUM. GENER. X (CHAR RESOL.)
0000110A  =00000009                370  GRDSCNGY    EQU     GRDYOFF/CHRHEIGH        ; NUM. GENER. Y (CHAR RESOL.)
0000110A  =00000009                371  -------------------- end include --------------------
0000110A                           372              INCLUDE "UTIL.X68"              ; UTILITY CODE
0000110A                           373  ; =============================================================================
0000110A                           374  ; TITLE    : UTILITY SUBROUTINES
0000110A                           375  ; AUTHOR   : ANTONI BURGUERA
0000110A                           376  ; HISTORY  : 05-JULY-2021 - CREATION
0000110A                           377  ; COMMENTS : GENERAL PURPOSE SUBROUTINES.
0000110A                           378  ; =============================================================================
0000110A                           379  
0000110A                           380  ; -----------------------------------------------------------------------------
0000110A                           381  UTLINIT
0000110A                           382  ; INITIALIZES UTILITIES.
0000110A                           383  ; INPUT    : NONE
0000110A                           384  ; OUTPUT   : NONE
0000110A                           385  ; MODIFIES : NONE
0000110A                           386  ; -----------------------------------------------------------------------------
0000110A  4239 00001B20            387              CLR.B   (UTLRNDIX)
00001110  4E75                     388              RTS
00001112                           389  
00001112                           390  ; -----------------------------------------------------------------------------
00001112                           391  UTLSTRLN
00001112                           392  ; COMPUTES THE LENGTH OF A ZERO-TERMINATED STRING
00001112                           393  ; INPUT    - A1 POINTER TO THE STRING
00001112                           394  ; OUTPUT   - D0.W STRING LENGTH
00001112                           395  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001112                           396  ; -----------------------------------------------------------------------------
00001112  2F09                     397              MOVE.L  A1,-(A7)
00001114  4240                     398              CLR.W   D0
00001116  4A19                     399  .LOOP       TST.B   (A1)+
00001118  6700 0006                400              BEQ     .END
0000111C  5240                     401              ADDQ.W  #1,D0
0000111E  60F6                     402              BRA     .LOOP
00001120  225F                     403  .END        MOVE.L  (A7)+,A1
00001122  4E75                     404              RTS
00001124                           405  
00001124                           406  ; -----------------------------------------------------------------------------
00001124                           407  UTLRAND
00001124                           408  ; PROVIDES A PSEUDO-RANDOM COIN FLIP (RETURNS 1 OR 2)
00001124                           409  ; INPUT    - NONE
00001124                           410  ; OUTPUT   - D1.L RANDOM VALUE (ONLY BYTE)
00001124                           411  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001124                           412  ; -----------------------------------------------------------------------------
00001124  2F08                     413              MOVE.L  A0,-(A7)
00001126  41F9 00001142            414              LEA     .RANDVEC,A0
0000112C  4281                     415              CLR.L   D1
0000112E  1239 00001B20            416              MOVE.B  (UTLRNDIX),D1
00001134  1230 1800                417              MOVE.B  (A0,D1.L),D1
00001138  5239 00001B20            418              ADDQ.B  #1,(UTLRNDIX)
0000113E  205F                     419              MOVE.L  (A7)+,A0
00001140  4E75                     420              RTS
00001142                           421  
00001142= 02 02 02 02 01 02 ...    422  .RANDVEC    DC.B    2, 2, 2, 2, 1, 2, 1, 2
0000114A= 01 01 01 02 01 01 ...    423              DC.B    1, 1, 1, 2, 1, 1, 1, 2
00001152= 02 01 02 01 01 02 ...    424              DC.B    2, 1, 2, 1, 1, 2, 2, 1
0000115A= 02 01 02 01 01 01 ...    425              DC.B    2, 1, 2, 1, 1, 1, 1, 2
00001162= 02 02 01 01 02 02 ...    426              DC.B    2, 2, 1, 1, 2, 2, 1, 1
0000116A= 02 01 02 02 02 01 ...    427              DC.B    2, 1, 2, 2, 2, 1, 1, 1
00001172= 02 02 01 01 01 01 ...    428              DC.B    2, 2, 1, 1, 1, 1, 1, 2
0000117A= 01 01 01 02 01 02 ...    429              DC.B    1, 1, 1, 2, 1, 2, 1, 2
00001182= 02 02 02 02 01 02 ...    430              DC.B    2, 2, 2, 2, 1, 2, 1, 2
0000118A= 01 01 02 02 02 01 ...    431              DC.B    1, 1, 2, 2, 2, 1, 2, 1
00001192= 02 02 02 01 01 02 ...    432              DC.B    2, 2, 2, 1, 1, 2, 1, 1
0000119A= 01 02 01 01 01 02 ...    433              DC.B    1, 2, 1, 1, 1, 2, 1, 2
000011A2= 01 02 02 01 02 01 ...    434              DC.B    1, 2, 2, 1, 2, 1, 2, 2
000011AA= 01 02 01 02 01 01 ...    435              DC.B    1, 2, 1, 2, 1, 1, 2, 1
000011B2= 01 02 01 01 01 01 ...    436              DC.B    1, 2, 1, 1, 1, 1, 1, 1
000011BA= 02 01 01 02 01 01 ...    437              DC.B    2, 1, 1, 2, 1, 1, 1, 2
000011C2= 02 01 01 01 01 02 ...    438              DC.B    2, 1, 1, 1, 1, 2, 1, 1
000011CA= 01 01 02 01 01 02 ...    439              DC.B    1, 1, 2, 1, 1, 2, 1, 2
000011D2= 02 02 01 01 02 02 ...    440              DC.B    2, 2, 1, 1, 2, 2, 2, 2
000011DA= 01 01 02 01 02 02 ...    441              DC.B    1, 1, 2, 1, 2, 2, 1, 2
000011E2= 01 02 01 02 02 02 ...    442              DC.B    1, 2, 1, 2, 2, 2, 2, 1
000011EA= 01 01 02 02 01 01 ...    443              DC.B    1, 1, 2, 2, 1, 1, 2, 1
000011F2= 02 02 01 02 01 02 ...    444              DC.B    2, 2, 1, 2, 1, 2, 1, 1
000011FA= 02 01 02 01 01 02 ...    445              DC.B    2, 1, 2, 1, 1, 2, 1, 2
00001202= 01 01 02 02 02 01 ...    446              DC.B    1, 1, 2, 2, 2, 1, 1, 1
0000120A= 01 01 02 02 01 02 ...    447              DC.B    1, 1, 2, 2, 1, 2, 1, 2
00001212= 01 02 01 01 01 02 ...    448              DC.B    1, 2, 1, 1, 1, 2, 1, 1
0000121A= 02 01 01 02 01 02 ...    449              DC.B    2, 1, 1, 2, 1, 2, 2, 2
00001222= 02 01 01 01 02 02 ...    450              DC.B    2, 1, 1, 1, 2, 2, 1, 1
0000122A= 02 02 02 01 02 02 ...    451              DC.B    2, 2, 2, 1, 2, 2, 1, 2
00001232= 01 02 01 01 02 01 ...    452              DC.B    1, 2, 1, 1, 2, 1, 2, 2
0000123A= 02 02 02 01 01 01 ...    453              DC.B    2, 2, 2, 1, 1, 1, 1, 2
0000123A= 02 02 02 01 01 01 ...    454  -------------------- end include --------------------
00001242                           455              INCLUDE "BUTTON.X68"            ; BUTTON MANAGEMENT
00001242                           456  ; =============================================================================
00001242                           457  ; TITLE    : BUTTON MANAGEMENT
00001242                           458  ; AUTHOR   : ANTONI BURGUERA
00001242                           459  ; HISTORY  : 05-JULY-2021 - CREATION
00001242                           460  ; COMMENTS : * A BUTTON IS DEFINED BY A STATIC DATA BLOCK (SDB), WHICH DOES NOT
00001242                           461  ;              CHANGE OVER TIME, AND A VARIABLE DATA BLOCK (VDB), THAT CAN
00001242                           462  ;              CHANGE OVER TIME. CHANGES IN THE VDB ARE PRODUCED WHEN CALLING
00001242                           463  ;              SUBROUTINE BTNUPD.
00001242                           464  ;
00001242                           465  ;            * THE BUTTON SDB (CAN BE IN ROM) HAS THE FOLLOWING FIELDS. THE
00001242                           466  ;              NUMBER DENOTES THE OFFSET WITH RESPECT TO THE SDB START:
00001242                           467  ;
00001242                           468  ;                +0  - WORD - YTOP COORDINATE (PIXELS)
00001242                           469  ;                +2  - WORD - XLEFT COORDINATE (PIXELS)
00001242                           470  ;                +4  - WORD - HEIGHT (PIXELS)
00001242                           471  ;                +6  - WORD - WIDTH (PIXELS)
00001242                           472  ;                +8  - LONG - CALLBACK POINTER
00001242                           473  ;                +12 - BYTE STRING - ZERO TERMINATED STRING. TEXT TO SHOW.
00001242                           474  ;
00001242                           475  ;            * THE BUTTON VDB (MUST BE IN RAM) IS:
00001242                           476  ;
00001242                           477  ;                +0 - LONG - POINTER TO THE STATIC DATABLOCK
00001242                           478  ;                +4 - BYTE - STATUS WITH FORMAT XXXXXCPI WHERE:
00001242                           479  ;                            - I (BIT 0) - 1=MOUSE INSIDE, 0=MOUSE OUTSIDE
00001242                           480  ;                            - P (BIT 1) - 1=MOUSE PRESSED INSIDE
00001242                           481  ;                                          0=MOUSE NOT PRESSED INSIDE
00001242                           482  ;                            - C (BIT 2) - 1=MOUSE CLICKED INSIDE
00001242                           483  ;                                          0=MOUSE NOT CLICKED INSIDE
00001242                           484  ;                            NOTE THAT IF I=0 THEN P=C=0, IF I=1 AND P=0
00001242                           485  ;                            THEN C=0.
00001242                           486  ; =============================================================================
00001242                           487  
00001242                           488  ; -----------------------------------------------------------------------------
00001242                           489  BTNINIT
00001242                           490  ; INITIALIZES THE BUTTON BY:
00001242                           491  ;  * COPYING THE SDB POINTER INTO THE VDB.
00001242                           492  ;  * CLEARING THE STATUS BYTE.
00001242                           493  ; INPUT    : A0 - POINTER TO THE VARIABLE DATABLOCK
00001242                           494  ;            A1 - POINTER TO THE STATIC DATABLOCK
00001242                           495  ; OUTPUT   : NONE
00001242                           496  ; MODIFIES : NONE
00001242                           497  ; -----------------------------------------------------------------------------
00001242                           498  
00001242                           499  ; TODO : PLACE YOUR CODE HERE  
00001242                           500  
00001242                           501              ;Copiamos SDB (A1) en el contenido de VDB ((A0))         
00001242  2089                     502              MOVE.L A1,(A0)
00001244                           503              
00001244                           504              ;Limpiamos el B status
00001244  4228 0004                505              CLR.B 4(A0) 
00001248                           506             
00001248  4E75                     507              RTS
0000124A                           508  ; -----------------------------------------------------------------------------
0000124A                           509  BTNUPD
0000124A                           510  ; UPDATES THE BUTTON VDB AND EXECUTES THE CALLBACK IF REQUIRED
0000124A                           511  ; INPUT    : A0 - POINTER TO THE VARIABLE DATABLOCK
0000124A                           512  ; OUTPUT   : NONE
0000124A                           513  ; MODIFIES : NONE
0000124A                           514  ; -----------------------------------------------------------------------------
0000124A                           515  
0000124A                           516  ; TODO : PLACE YOUR CODE HERE
0000124A                           517           
0000124A  48E7 FFE0                518              MOVEM.L D0-D7/A0-A2,-(A7)
0000124E                           519           
0000124E  2450                     520              MOVE.L (A0),A2
00001250                           521           
00001250                           522              ;Máscara para dejar a 0 los 3 últimos bits del status
00001250  0228 00F8 0004           523              AND.B #%11111000,4(A0)  
00001256                           524           
00001256  3039 00001B1C            525              MOVE.W (MOUX),D0
0000125C  322A 0002                526              MOVE.W 2(A2),D1
00001260  9041                     527              SUB.W D1,D0
00001262                           528              
00001262  342A 0006                529              MOVE.W 6(A2),D2
00001266  D242                     530              ADD.W D2,D1
00001268  B240                     531              CMP.W D0,D1
0000126A                           532           
0000126A  6C00 0008                533              BGE MAYOR_X
0000126E  4EF9 00001304            534              JMP FINAL
00001274                           535              
00001274  B07C 0000                536  MAYOR_X:    CMP.W #0,D0
00001278  6F00 008A                537              BLE FINAL
0000127C  3639 00001B1C            538              MOVE.W (MOUX),D3
00001282  B243                     539              CMP.W D3,D1
00001284  6C00 0008                540              BGE IN_X 
00001288  4EF9 00001304            541              JMP FINAL
0000128E                           542  
0000128E  3039 00001B1A            543  IN_X:       MOVE.W (MOUY),D0
00001294  3212                     544              MOVE.W (A2),D1
00001296  9041                     545              SUB.W D1,D0
00001298                           546              
00001298  342A 0004                547              MOVE.W 4(A2),D2
0000129C  D242                     548              ADD.W D2,D1
0000129E  B240                     549              CMP D0,D1
000012A0  6C00 0008                550              BGE MAYOR_Y
000012A4  4EF9 00001304            551              JMP FINAL
000012AA                           552              
000012AA  B07C 0000                553  MAYOR_Y:    CMP.W #0,D0
000012AE  6F00 0054                554              BLE FINAL
000012B2  3639 00001B1A            555              MOVE.W (MOUY),D3
000012B8  B243                     556              CMP.W D3,D1
000012BA  6C00 0008                557              BGE BIT_I
000012BE  4EF9 00001304            558              JMP FINAL
000012C4                           559           
000012C4  0028 0001 0004           560  BIT_I:      ORI.B #%00000001,4(A0)
000012CA  1239 00001B1E            561              MOVE.B (MOUVAL),D1
000012D0  0801 0000                562              BTST.L #0,D1
000012D4  6600 0008                563              BNE BIT_P
000012D8  4EF9 00001304            564              JMP FINAL
000012DE                           565              
000012DE  0028 0002 0004           566  BIT_P:      ORI.B #%00000010,4(A0)
000012E4  1239 00001B1F            567              MOVE.B (MOUEDGE),D1
000012EA  0801 0000                568              BTST.L #0,D1
000012EE  6600 0008                569              BNE BIT_C
000012F2  4EF9 00001304            570              JMP FINAL
000012F8                           571              
000012F8  0028 0004 0004           572  BIT_C:      ORI.B #%00000100,4(A0)
000012FE  2469 0008                573              MOVE.L 8(A1),A2
00001302  4E92                     574              JSR (A2)
00001304                           575  
00001304                           576           
00001304  4CDF 07FF                577  FINAL:   MOVEM.L (A7)+,D0-D7/A0-A2
00001308  4E75                     578           RTS
0000130A                           579  
0000130A                           580  
0000130A                           581  
0000130A                           582  
0000130A                           583  
0000130A                           584  
0000130A                           585  
0000130A                           586  
0000130A                           587  ; -----------------------------------------------------------------------------
0000130A                           588  BTNPLOT
0000130A                           589  ; PLOTS THE BUTTON. A RECTANGLE IS DRAWN WITH THICKNESS BTNPENWD. THE CONTOUR
0000130A                           590  ; COLOR IS BTNPENCL. THE FILL COLOR IS BLACK IF THE MOUSE IS NOT INSIDE,
0000130A                           591  ; BTNSELCL IF THE MOUSE IS INSIDE BUT THE MOUSE BUTTON IS NOT PRESSED AND
0000130A                           592  ; BTNPRSCL IF THE MOUSE BUTTON IS PRESSED INSIDE.
0000130A                           593  ; INPUT    : A0 - POINTER TO THE VARIABLE DATABLOCK
0000130A                           594  ; OUTPUT   : NONE
0000130A                           595  ; MODIFIES : NONE
0000130A                           596  ; -----------------------------------------------------------------------------
0000130A                           597  
0000130A                           598  ; TODO : PLACE YOUR CODE HERE
0000130A                           599  
0000130A  48E7 FFC0                600          MOVEM.L D0-D7/A0-A1,-(A7)
0000130E  103C 005D                601          MOVE.B #93,D0
00001312  123C 0004                602          MOVE.B #BTNPENWD,D1
00001316  4E4F                     603          TRAP #15
00001318                           604          
00001318  103C 0050                605          MOVE.B #80,D0
0000131C  223C 00005500            606          MOVE.L #BTNPENCL,D1
00001322  4E4F                     607          TRAP #15
00001324                           608          
00001324  1628 0004                609          MOVE.B 4(A0),D3
00001328  0803 0000                610          BTST.L #0,D3
0000132C  6600 0008                611          BNE INSIDE
00001330                           612          
00001330  4EF9 00001362            613          JMP OUT
00001336                           614  
00001336  0803 0001                615  INSIDE: BTST.L #1,D3
0000133A  6600 0014                616          BNE PRESSED
0000133E  103C 0051                617          MOVE.B #81,D0
00001342  223C 0000AA00            618          MOVE.L #BTNSELCL,D1
00001348  4E4F                     619          TRAP #15
0000134A                           620          
0000134A  4EF9 0000136A            621          JMP FINAL1
00001350                           622  
00001350  103C 0051                623  PRESSED: MOVE.B #81,D0
00001354  223C 00006600            624           MOVE.L #BTNPRSCL,D1
0000135A  4E4F                     625           TRAP #15
0000135C                           626           
0000135C  4EF9 0000136A            627           JMP FINAL1
00001362                           628           
00001362  103C 0051                629  OUT:     MOVE.B #81,D0
00001366  7200                     630           MOVE.L #0,D1
00001368  4E4F                     631           TRAP #15
0000136A                           632  
0000136A                           633  
0000136A  2250                     634  FINAL1:  MOVE.L (A0),A1
0000136C                           635           
0000136C  103C 0057                636           MOVE.B #87,D0
00001370  3229 0002                637           MOVE.W 2(A1),D1
00001374  3411                     638           MOVE.W (A1),D2
00001376  3601                     639           MOVE.W D1,D3
00001378  D669 0006                640           ADD.W 6(A1),D3
0000137C  3802                     641           MOVE.W D2,D4
0000137E  D869 0004                642           ADD.W 4(A1),D4
00001382  4E4F                     643           TRAP #15
00001384                           644           
00001384  103C 005F                645           MOVE.B #95,D0
00001388  3229 0002                646           MOVE.W 2(A1),D1
0000138C  0641 0028                647           ADD.W #40,D1
00001390                           648           
00001390  3411                     649           MOVE.W (A1),D2
00001392  0642 000F                650           ADD.W #15,D2
00001396                           651           
00001396  D2FC 000C                652           ADD.W #12,A1
0000139A                           653           
0000139A  4E4F                     654           TRAP #15
0000139C                           655           
0000139C  4CDF 03FF                656           MOVEM.L (A7)+,D0-D7/A0-A1
000013A0                           657  
000013A0  4E75                     658           RTS
000013A2                           659  
000013A2                           660  
000013A2                           661  
000013A2                           662  
000013A2                           663  
000013A2                           664  
000013A2                           665  
000013A2                           666  
000013A2                           667  
000013A2                           668  
000013A2                           669  
000013A2                           670  
000013A2                           671  
000013A2                           672  
000013A2                           673  
000013A2                           674  
000013A2                           675  
000013A2                           676  
000013A2                           677  
000013A2                           678  -------------------- end include --------------------
000013A2                           679              INCLUDE "BTNLIST.X68"           ; BUTTON LIST MANAGEMENT
000013A2                           680  ; =============================================================================
000013A2                           681  ; TITLE    : BUTTON LIST MANAGEMENT
000013A2                           682  ; AUTHOR   : ANTONI BURGUERA
000013A2                           683  ; HISTORY  : 05-JULY-2021 - CREATION
000013A2                           684  ; COMMENTS : * ALLOWS ADDING, UPDATING AND PLOTTING A LIST OF BUTTONS. ALLOWS
000013A2                           685  ;              REMOVING THEM ALL, BUT NOT INDIVIDUALLY.
000013A2                           686  ;
000013A2                           687  ;            * THE LIST OF BUTTONS IS STORED AS A LIST OF BUTTON'S VDB. THIS
000013A2                           688  ;              LIST IS STORED AT BTLDATA.
000013A2                           689  ;
000013A2                           690  ;            * THE LIST OF VBD IS BUILT ASSUMING A MAXIMUM OF BTLMXVDB BUTTONS
000013A2                           691  ;              AND A SIZE OF BTNSZVDB BYTES FOR EACH VDB.
000013A2                           692  ; =============================================================================
000013A2                           693  
000013A2                           694  ; -----------------------------------------------------------------------------
000013A2                           695  BTLINIT
000013A2                           696  ; INITIALIZES BUTTON LIST BY SETTING ALL THE POINTERS TO STATIC DATA BLOCKS
000013A2                           697  ; TO $FFFFFFFF.
000013A2                           698  ; INPUT    : NONE
000013A2                           699  ; OUTPUT   : NONE
000013A2                           700  ; MODIFIES : NONE
000013A2                           701  ; -----------------------------------------------------------------------------
000013A2  48E7 8080                702              MOVEM.L D0/A0,-(A7)
000013A6  41F9 00001B22            703              LEA     BTLDATA,A0
000013AC  303C 0009                704              MOVE.W  #BTLMXVDB-1,D0          ; NUM ITERATIONS
000013B0  20BC FFFFFFFF            705  .LOOP       MOVE.L  #$FFFFFFFF,(A0)         ; MARK SLOT AS EMPTY
000013B6  5C88                     706              ADD.L   #BTNSZVDB,A0            ; GO TO NEXT SLOT
000013B8  51C8 FFF6                707              DBRA.W  D0,.LOOP                ; LOOP FOR ALL SLOTS
000013BC  4CDF 0101                708              MOVEM.L (A7)+,D0/A0
000013C0  4E75                     709              RTS
000013C2                           710  
000013C2                           711  ; -----------------------------------------------------------------------------
000013C2  =000013A2                712  BTLCLEAR    EQU     BTLINIT
000013C2                           713  ; CLEARS THE BUTTON LIST. SAME AS BTLINIT.
000013C2                           714  ; INPUT    : NONE
000013C2                           715  ; OUTPUT   : NONE
000013C2                           716  ; MODIFIES : NONE
000013C2                           717  ; -----------------------------------------------------------------------------
000013C2                           718  
000013C2                           719  ; -----------------------------------------------------------------------------
000013C2                           720  BTLADD
000013C2                           721  ; ADDS A NEW BUTTON INTO THE BUTTON LIST AND INITS IT.
000013C2                           722  ; INPUT    : A1 - POINTER TO THE BUTTON SDB
000013C2                           723  ; OUTPUT   : NONE
000013C2                           724  ; MODIFIES : NONE
000013C2                           725  ; -----------------------------------------------------------------------------
000013C2  48E7 8080                726              MOVEM.L A0/D0,-(A7)
000013C6                           727  
000013C6                           728              ; SEARCH FOR AN EMPTY SLOT
000013C6                           729  
000013C6  41F9 00001B22            730              LEA     BTLDATA,A0
000013CC  303C 0009                731              MOVE.W  #BTLMXVDB-1,D0
000013D0  0C90 FFFFFFFF            732  .LOOP       CMP.L   #$FFFFFFFF,(A0)
000013D6  6700 000E                733              BEQ     .FOUND
000013DA  5C88                     734              ADD.L   #BTNSZVDB,A0
000013DC  51C8 FFF2                735              DBRA.W  D0,.LOOP
000013E0                           736  
000013E0                           737              ; NO SLOT? DO NOTHING
000013E0                           738  
000013E0  4CDF 0101                739  .END        MOVEM.L (A7)+,A0/D0
000013E4  4E75                     740              RTS
000013E6                           741  
000013E6                           742              ; SLOT FOUND? PLACE THE BUTTON THERE BY CALLING BTNINIT
000013E6                           743  
000013E6  4EB8 1242                744  .FOUND      JSR     BTNINIT
000013EA  60F4                     745              BRA     .END
000013EC                           746  
000013EC                           747  ; -----------------------------------------------------------------------------
000013EC                           748  BTLUPD
000013EC                           749  ; CALLS BTNUPD FOR ALL THE BUTTONS IN THE BUTTON LIST.
000013EC                           750  ; INPUT    : NONE
000013EC                           751  ; OUTPUT   : NONE
000013EC                           752  ; MODIFIES : NONE
000013EC                           753  ; -----------------------------------------------------------------------------
000013EC                           754  
000013EC  48E7 8080                755              MOVEM.L A0/D0,-(A7)
000013F0                           756  
000013F0                           757              ; TRAVERSE THE LIST
000013F0                           758  
000013F0  41F9 00001B22            759              LEA     BTLDATA,A0
000013F6  303C 0009                760              MOVE.W  #BTLMXVDB-1,D0
000013FA  0C90 FFFFFFFF            761  .LOOP       CMP.L   #$FFFFFFFF,(A0)
00001400  6700 000C                762              BEQ     .DONE
00001404                           763  
00001404                           764              ; UPDATE EACH BUTTON
00001404                           765  
00001404  4EB8 124A                766              JSR     BTNUPD
00001408                           767  
00001408                           768              ; GO TO THE NEXT BUTTON
00001408                           769  
00001408  5C88                     770              ADD.L   #BTNSZVDB,A0
0000140A  51C8 FFEE                771              DBRA.W  D0,.LOOP
0000140E                           772  
0000140E  4CDF 0101                773  .DONE       MOVEM.L (A7)+,A0/D0
00001412  4E75                     774              RTS
00001414                           775  
00001414                           776  
00001414                           777  ; -----------------------------------------------------------------------------
00001414                           778  BTLPLOT
00001414                           779  ; CALLS BTNPLOT FOR ALL THE BUTTONS IN THE BUTTON LIST.
00001414                           780  ; INPUT    : NONE
00001414                           781  ; OUTPUT   : NONE
00001414                           782  ; MODIFIES : NONE
00001414                           783  ; -----------------------------------------------------------------------------
00001414                           784  
00001414                           785  ; TODO : PLACE YOUR CODE HERE
00001414  48E7 8080                786              MOVEM.L A0/D0,-(A7)
00001418                           787  
00001418                           788              ;Recorremos la lista
00001418  41F9 00001B22            789              LEA     BTLDATA,A0
0000141E  303C 0009                790              MOVE.W  #BTLMXVDB-1,D0
00001422  0C90 FFFFFFFF            791  .LOOP       CMP.L   #$FFFFFFFF,(A0)
00001428  6700 000C                792              BEQ     .FIN
0000142C                           793  
0000142C                           794              ;Actualizamos el botón
0000142C  4EB8 130A                795              JSR     BTNPLOT
00001430                           796  
00001430                           797              ;Siguiente botón
00001430  5C88                     798              ADD.L   #BTNSZVDB,A0
00001432                           799              
00001432                           800              ;Volvemos al bucle para los otros botones
00001432  51C8 FFEE                801              DBRA  D0,.LOOP
00001436                           802  
00001436  4CDF 0101                803  .FIN        MOVEM.L (A7)+,A0/D0
0000143A  4E75                     804              RTS
0000143C                           805  
0000143C                           806  
0000143C                           807  
0000143C                           808  
0000143C                           809  
0000143C                           810  
0000143C                           811  
0000143C                           812  
0000143C                           813  
0000143C                           814  
0000143C                           815  
0000143C                           816  
0000143C                           817  
0000143C                           818  -------------------- end include --------------------
0000143C                           819              INCLUDE "GRID.X68"              ; GRID MANAGEMENT
0000143C                           820  ; =============================================================================
0000143C                           821  ; TITLE    : GRID MANAGEMENT
0000143C                           822  ; AUTHOR   : ANTONI BURGUERA
0000143C                           823  ; HISTORY  : 05-JULY-2021 - CREATION
0000143C                           824  ; COMMENTS : * THERE ARE TWO MATRICES (GRDMATR0 AND GRDMATR1) AND TWO POINTERS
0000143C                           825  ;              TO THESE MATRICES (GRDSRC AND GRDDST).
0000143C                           826  ;
0000143C                           827  ;            * THE MATRIX TO BE PLOTTED IS ALWAYS THE ONE POINTED BY GRDDST.
0000143C                           828  ;
0000143C                           829  ;            * THE MATRIX TO BE UPDATED BY THE MOUSE (GRDMUPD) IS ALWAYS THE
0000143C                           830  ;              ONE POINTED BY GRDDST.
0000143C                           831  ;
0000143C                           832  ;            * THE RULES-UPDATE (GRDRUPD) SWITCHES THE POINTERS AND THEN READS
0000143C                           833  ;              THE NEW SOURCE MATRIX (GRDSRC) TO DETERMINE THE NUMBER OF
0000143C                           834  ;              NEIGHBORS. THE RESULTING CELL VALUE IS WRITTEN TO THE DESTINA-
0000143C                           835  ;              TION MATRIX, POINTED BY GRDDST.
0000143C                           836  ; =============================================================================
0000143C                           837  
0000143C                           838  ; -----------------------------------------------------------------------------
0000143C                           839  GRDINIT
0000143C                           840  ; INITIALIZE THE GRID AS FOLLOWS:
0000143C                           841  ; * POINTS THE SOURCE GRID POINTER TO GRDMATR0.
0000143C                           842  ; * POINTS THE DESTINATION GRID POINTER TO GRDMATR1.
0000143C                           843  ; * RESETS THE COUNTERS (GRDNPLR1, GRDNPLR2, GRDNGEN).
0000143C                           844  ; * FILLS THE TWO MATRICES (GRDMATR0 AND GRDMATR1) WITH ZEROS.
0000143C                           845  ; INPUT    : NONE
0000143C                           846  ; OUTPUT   : NONE
0000143C                           847  ; MODIFIES : NONE
0000143C                           848  ; -----------------------------------------------------------------------------
0000143C  48E7 8080                849              MOVEM.L A0/D0,-(A7)
00001440  23FC 00001B66 00001B5E   850              MOVE.L  #GRDMATR0,(GRDSRC)
0000144A  23FC 00002366 00001B62   851              MOVE.L  #GRDMATR1,(GRDDST)
00001454  4279 00002B66            852              CLR.W   (GRDNPLR1)
0000145A  4279 00002B68            853              CLR.W   (GRDNPLR2)
00001460  4279 00002B6A            854              CLR.W   (GRDNGEN)
00001466  41F9 00001B66            855              LEA     GRDMATR0,A0
0000146C  303C 0FFF                856              MOVE.W  #GRDWIDTH*GRDHEIGH*2-1,D0
00001470  4218                     857  .LOOP       CLR.B   (A0)+
00001472  51C8 FFFC                858              DBRA.W  D0,.LOOP
00001476  4CDF 0101                859              MOVEM.L (A7)+,A0/D0
0000147A  4E75                     860              RTS
0000147C                           861  
0000147C                           862  ; -----------------------------------------------------------------------------
0000147C                           863  GRDMUPD
0000147C                           864  ; GRID UPDATE USING MOUSE. THE INTERFACE IS AS FOLLOWS:
0000147C                           865  ; * IF MOUSE IS NOT PRESSED OR IS OUTSIDE THE PLOTTED GRID, DOES NOTHING.
0000147C                           866  ; * IF LEFT MOUSE BUTTON IS PRESSED INSIDE THE GRID:
0000147C                           867  ;   - A PLAYER 1 (VALUE=1) CELL IS CREATED AT THE MOUSE POSITION IF THE MOUSE
0000147C                           868  ;     IS ON THE LEFT HALF OF THE GRID.
0000147C                           869  ;   - A PLAYER 2 (VALUE=2) CELL IS CREATED AT THE MOUSE POSITION IF THE MOUSE
0000147C                           870  ;     IS ON THE RIGHT HALF OF THE GRID.
0000147C                           871  ; * IF RIGHT MOUSE BUTTON IS PRESSED INSIDE THE GRID, THE CELL WHERE THE MOUSE
0000147C                           872  ;   IS IS CLEARED (VALUE=0).
0000147C                           873  ; INPUT    : NONE
0000147C                           874  ; OUTPUT   : NONE
0000147C                           875  ; MODIFIES : NONE
0000147C                           876  ; -----------------------------------------------------------------------------
0000147C                           877  
0000147C                           878  ; TODO : PLACE YOUR CODE HERE
0000147C                           879  ;D0:X ->COLUMNA , D1:Y->FILA , D2:MOUVAL, D3:NUM CASILLA
0000147C  48E7 F880                880              MOVEM.L D0-D4/A0,-(A7)
00001480  4280                     881              CLR.L D0
00001482  4282                     882              CLR.L D2
00001484  4281                     883              CLR.L D1
00001486  1639 00001B1E            884              MOVE.B (MOUVAL),D3
0000148C  B63C 0000                885              CMP.B #0,D3
00001490  6700 008C                886              BEQ .FINAL
00001494                           887   ;COMPROBAMOS SI EL MOUSE ESTA DENTRO DE LA MATRIZ          
00001494  3239 00001B1C            888              MOVE.W (MOUX),D1
0000149A  B27C 0010                889              CMP.W #GRDXOFF,D1
0000149E  6F00 007E                890              BLE .FINAL
000014A2  0441 0010                891              SUB.W #GRDXOFF,D1
000014A6  B27C 0300                892              CMP.W #GRDPXWID,D1
000014AA  6C00 0072                893              BGE .FINAL
000014AE  3439 00001B1A            894              MOVE.W (MOUY),D2
000014B4  B47C 009E                895              CMP.W #GRDYOFF,D2
000014B8  6F00 0064                896              BLE .FINAL
000014BC  0442 009E                897              SUB.W #GRDYOFF,D2
000014C0  B47C 0180                898              CMP.W #GRDPXHEI,D2
000014C4                           899              
000014C4  6C00 0058                900              BGE .FINAL
000014C8                           901              
000014C8  83FC 000C                902              DIVS.W #GRDSZCEL,D1
000014CC  85FC 000C                903              DIVS.W #GRDSZCEL,D2
000014D0  41F9 00001B62            904              LEA GRDDST,A0
000014D6  3002                     905              MOVE.W D2,D0
000014D8  C1FC 0040                906              MULS.W #GRDWIDTH,D0
000014DC  D041                     907              ADD.W D1,D0
000014DE  C63C 0001                908              AND.B #MOUMSKLF,D3
000014E2  6700 0036                909              BEQ .R_GRID
000014E6  1801                     910              MOVE.B D1,D4
000014E8  89FC 0020                911              DIVS.W #GRDWIDTH/2,D4
000014EC  5204                     912              ADDQ.B #1,D4
000014EE  1184 0000                913              MOVE.B D4,(A0,D0)
000014F2  B83C 0001                914              CMP.B #1,D4
000014F6  6600 000E                915              BNE .P1
000014FA  5279 00002B66            916              ADD.W #1,(GRDNPLR1)
00001500  4EF9 0000151E            917              JMP .FINAL
00001506                           918  .P1         
00001506  B83C 0002                919              CMP.B #2,D4
0000150A  6600 0012                920              BNE .FINAL
0000150E  5279 00002B68            921              ADD.W #1,(GRDNPLR2)
00001514  4EF9 0000151E            922              JMP .FINAL
0000151A                           923              
0000151A  4230 0000                924  .R_GRID: CLR.B (A0,D0)
0000151E                           925   
0000151E                           926  
0000151E                           927              
0000151E                           928  
0000151E  4CDF 011F                929  .FINAL:   MOVEM.L (A7)+,D0-D4/A0
00001522  4E75                     930            RTS
00001524                           931  ; -----------------------------------------------------------------------------
00001524                           932  GRDRUPD
00001524                           933  ; UPDATES THE GRID ACCORDING TO 2-PLAYER GAME OF LIFE RULES AS FOLLOWS:
00001524                           934  ; * ADDS 1 TO THE NUMBER OF GENERATIONS (GRDNGEN)
00001524                           935  ; * SWITCHES THE MATRIX POINTERS (GRDDST AND GRDSRC).
00001524                           936  ; * CHECKS THE NEIGHBORS USING THE NEW SOURCE MATRIX (POINTER BY GRDDRC)
00001524                           937  ; * THE RESULTS OF APPLYING THE RULES ARE WRITTEN INTO THE NEW DESTINATION
00001524                           938  ;   MATRIX (POINTED BY GRDDST).
00001524                           939  ; * THE RULES ARE THE FOLLOWING, WHERE P1 AND P2 ARE 1 AND 2 RESPECTIVELY,
00001524                           940  ;   DEAD CELLS ARE REPRESENTED BY 0 AND NP1 AND NP2 DENOTE THE NUMBER OF
00001524                           941  ;   PLAYER 1 AND PLAYER 2 NEIGHBORS RESPECTIVELY:
00001524                           942  ;   + SURVIVAL RULES
00001524                           943  ;     - IF CELL IS P1 AND NP1-NP2 IS 2 OR 3 -> NEW VALUE IS P1
00001524                           944  ;     - IF CELL IS P1 AND NP1-NP2 IS 1 AND NP1>=2 -> NEW VALUE IS P1
00001524                           945  ;     - OTHERWISE -> NEW VALUE IS 0
00001524                           946  ;     - IF CELL IS P2 AND NP2-NP1 IS 2 OR 3 -> NEW VALUE IS P2
00001524                           947  ;     - IF CELL IS P2 AND NP2-NP1 IS 1 AND NP2>=2 -> NEW VALUE IS P2
00001524                           948  ;     - OTHERWISE -> NEW VALUE IS 0
00001524                           949  ;   + BIRTH RULES
00001524                           950  ;     - THE CELL HAS EXACTLY THREE P1 NEIGHBOURS AND THE NUMBER
00001524                           951  ;       OF P2 NEIGHBOURS IS DIFFERENT FROM THREE. IN THIS CASE A
00001524                           952  ;       P1 TOKEN IS BORN IN THE CELL.
00001524                           953  ;     - THE CELL HAS EXACTLY THREE P2 NEIGHBOURS AND THE NUMBER
00001524                           954  ;       OF P1 NEIGHBOURS IS DIFFERENT FROM THREE. IN THIS CASE A
00001524                           955  ;       P2 TOKEN IS BORN IN THE CELL.
00001524                           956  ;     - THE CELL HAS EXACTLY THREE WHITE AND THREE BLACK NEIGHBOURS.
00001524                           957  ;       IN THIS CASE AN UNBIASED COIN DETERMINES WHETHER A WHITE OR
00001524                           958  ;       BLACK TOKEN IS BORN IN THE CELL.
00001524                           959  ; INPUT    : NONE
00001524                           960  ; OUTPUT   : NONE
00001524                           961  ; MODIFIES : NONE
00001524                           962  ; -----------------------------------------------------------------------------
00001524                           963  
00001524                           964  ; TODO : PLACE YOUR CODE HERE
00001524                           965  ;D0:COLUMNA VECINO, D1:CONTADOR ITERACION, D2:CELL VALUE, D3:NP1 ,D4:NP2, D5:FILA VECINA, 
00001524                           966  ;D6:AUXILIAR PARA MOVIMIENTOS, D7:NUM CASILLAS
00001524  48E7 FF80                967          MOVEM.L D0-D7/A0,-(A7)
00001528                           968          
00001528  5279 00002B6A            969          ADDQ.W #1,(GRDNGEN)
0000152E  227C 00001B62            970          MOVE.L #GRDDST,A1
00001534  23FC 00001B5E 00001B62   971          MOVE.L #GRDSRC,(GRDDST)
0000153E  23C9 00001B5E            972          MOVE.L A1,(GRDSRC)
00001544                           973          
00001544  207C 00001B5E            974          MOVE.L #GRDSRC,A0
0000154A                           975          
0000154A  4241                     976          CLR D1
0000154C  323C FFFF                977          MOVE.W #$FFFFFFFF,D1
00001550                           978          
00001550  3C3C 0040                979          MOVE.W #GRDWIDTH,D6
00001554  CCFC 0020                980          MULU #GRDHEIGH,D6
00001558  5346                     981          SUB.W #1,D6
0000155A                           982          
0000155A                           983  .BUCLE:
0000155A                           984        
0000155A                           985  
0000155A                           986  .FINAL:
0000155A  4CDF 01FF                987          MOVEM.L (A7)+,D0-D7/A0
0000155E  4E75                     988          RTS
00001560                           989          
00001560  =0000003F                990  NOT_32   EQU %0111111
00001560  =0000007F                991  NOT_64   EQU %01111111 ;PARA HACER EL MODULO DE 64
00001560  =000007FF                992  NOT_2048 EQU %011111111111 ;PARA HACER EL MODULO DE 2048
00001560                           993  
00001560                           994  ; -----------------------------------------------------------------------------
00001560                           995  GRDSAVE
00001560                           996  ; SAVES THE GRID INTO A FILE IN CSV FORMAT
00001560                           997  ; INPUT    : NONE
00001560                           998  ; OUTPUT   : NONE
00001560                           999  ; MODIFIES : NONE
00001560                          1000  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
00001560                          1001  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
00001560                          1002  ; -----------------------------------------------------------------------------
00001560  48E7 FFFE               1003              MOVEM.L D0-D7/A0-A6,-(A7)       ; TO BE OPTIMIZED
00001564  103C 0032               1004              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
00001568  4E4F                    1005              TRAP    #15
0000156A  9FFC 00000200           1006              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
00001570  103C 003A               1007              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
00001574  7201                    1008              MOVE.L  #1,D1                   ; DISPLAY SAVE DIALOG
00001576  43F9 000015EC           1009              LEA     .MSG,A1                 ; STANDARD MESSAGE
0000157C  45F9 00001606           1010              LEA     .FILTER,A2              ; NO FILTER
00001582  264F                    1011              MOVE.L  A7,A3                   ; FILE NAME BUFFER
00001584  4253                    1012              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
00001586  4E4F                    1013              TRAP    #15
00001588  4A01                    1014              TST.B   D1
0000158A  6700 0054               1015              BEQ     .END                    ; IF CANCELLED, DO NOTHING
0000158E  224B                    1016              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
00001590  103C 0034               1017              MOVE.B  #52,D0                  ; CREATE NEW FILE
00001594  4E4F                    1018              TRAP    #15
00001596  4A40                    1019              TST.W   D0                      ; CHECK CREATION ERROR
00001598  6600 0046               1020              BNE     .END                    ; DO NOTHING MORE IF ERROR
0000159C  2C4F                    1021              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
0000159E  224F                    1022              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
000015A0  41F9 00001B62           1023              LEA GRDDST, A0                  ; A0: POINTER TO THE DATA TO WRITE
000015A6  363C 001F               1024              MOVE.W  #GRDHEIGH-1,D3          ; D3: NUMBER OF ROWS - 1
000015AA  343C 003F               1025  .LOOPY      MOVE.W  #GRDWIDTH-1,D2          ; D2: NUMBER OF COLUMNS - 1
000015AE  103C 0030               1026  .LOOP       MOVE.B  #'0',D0                 ; ADD CHAR '0' AND THE CELL VALUE
000015B2  D018                    1027              ADD.B   (A0)+,D0
000015B4  1CC0                    1028              MOVE.B  D0, (A6)+               ; STORE IT IN THE BUFFER
000015B6  1CFC 002C               1029              MOVE.B  #',',(A6)+              ; NOW PUT THE COMMA
000015BA  51CA FFF2               1030              DBRA.W  D2,.LOOP
000015BE  1D7C 000D FFFF          1031              MOVE.B  #$0D,-1(A6)             ; STORE CARRIAGE RETURN (REMOVE ',')
000015C4  1CBC 000A               1032              MOVE.B  #$0A,(A6)               ; STORE LINE FEED
000015C8  103C 0036               1033              MOVE.B  #54,D0                  ; WRITE TO FILE TASK NUMBER
000015CC  243C 00000081           1034              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO WRITE
000015D2  4E4F                    1035              TRAP    #15                     ; WRITE (A1 IS ALREADY THERE)
000015D4  2C49                    1036              MOVE.L  A1,A6                   ; GO BACK TO THE BUFFER START
000015D6  51CB FFD2               1037              DBRA.W  D3,.LOOPY
000015DA  103C 0038               1038              MOVE.B  #56,D0                  ; CLOSE FILE
000015DE  4E4F                    1039              TRAP    #15
000015E0  DFFC 00000200           1040  .END        ADD.L   #512,A7                 ; RESTORE STACK
000015E6  4CDF 7FFF               1041              MOVEM.L (A7)+,D0-D7/A0-A6       ; TO BE OPTIMIZED
000015EA  4E75                    1042              RTS
000015EC= 53 45 4C 45 43 54 ...   1043  .MSG        DC.B    'SELECT A CSV FILE TO SAVE',0
00001606= 2A 2E 43 53 56 00       1044  .FILTER     DC.B    '*.CSV',0
0000160C                          1045              DS.W    0
0000160C                          1046  
0000160C                          1047  ; -----------------------------------------------------------------------------
0000160C                          1048  GRDLOAD
0000160C                          1049  ; LOADS THE GRID FROM A CSV FORMATTED FILE
0000160C                          1050  ; INPUT    : NONE
0000160C                          1051  ; OUTPUT   : NONE
0000160C                          1052  ; MODIFIES : NONE
0000160C                          1053  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
0000160C                          1054  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
0000160C                          1055  ; -----------------------------------------------------------------------------
0000160C  48E7 FFFE               1056              MOVEM.L D0-D7/A0-A6,-(A7)       ; TO BE OPTIMIZED
00001610  103C 0032               1057              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
00001614  4E4F                    1058              TRAP    #15
00001616  9FFC 00000200           1059              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
0000161C  103C 003A               1060              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
00001620  4281                    1061              CLR.L   D1                      ; DISPLAY LOAD DIALOG
00001622  43F9 0000168C           1062              LEA     .MSG,A1                 ; STANDARD MESSAGE
00001628  45F9 000016A6           1063              LEA     .FILTER,A2              ; NO FILTER
0000162E  264F                    1064              MOVE.L  A7,A3                   ; FILE NAME BUFFER
00001630  4253                    1065              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
00001632  4E4F                    1066              TRAP    #15
00001634  4A01                    1067              TST.B   D1
00001636  6700 0048               1068              BEQ     .END                    ; IF CANCELLED, DO NOTHING
0000163A  224B                    1069              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
0000163C  103C 0033               1070              MOVE.B  #51,D0                  ; OPEN EXISTING FILE
00001640  4E4F                    1071              TRAP    #15
00001642  4A40                    1072              TST.W   D0                      ; CHECK ERRORS
00001644  6600 003A               1073              BNE     .END                    ; IF ERRORS, DO NOTHING MORE
00001648  2C4F                    1074              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
0000164A  224F                    1075              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
0000164C  41F9 00001B62           1076              LEA GRDDST, A0                  ; POINTER TO STORE PROCESS. DATA
00001652  363C 001F               1077              MOVE.W  #GRDHEIGH-1,D3
00001656  224E                    1078  .LOOP       MOVE.L  A6,A1
00001658  103C 0035               1079              MOVE.B  #53,D0                  ; READ DATA TASK NUMBER
0000165C  243C 00000081           1080              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO READ
00001662  4E4F                    1081              TRAP    #15                     ; READ THE DATA
00001664  343C 003F               1082              MOVE.W  #GRDWIDTH-1,D2
00001668  1019                    1083  .COPY       MOVE.B  (A1)+,D0                ; PICK ONE LOADED CHARACTER
0000166A  0400 0030               1084              SUB.B   #'0',D0                 ; CONVERT FROM ASCII TO NUMBER
0000166E  10C0                    1085              MOVE.B  D0,(A0)+                ; STORE DATA
00001670  5289                    1086              ADDQ.L  #1,A1                   ; SKIP THE COMMA
00001672  51CA FFF4               1087              DBRA.W  D2,.COPY
00001676  51CB FFDE               1088              DBRA.W  D3,.LOOP
0000167A  103C 0038               1089              MOVE.B  #56,D0                  ; CLOSE FILE
0000167E  4E4F                    1090              TRAP    #15
00001680  DFFC 00000200           1091  .END        ADD.L   #512,A7                 ; RESTORE STACK
00001686  4CDF 7FFF               1092              MOVEM.L (A7)+,D0-D7/A0-A6       ; TO BE OPTIMIZED
0000168A  4E75                    1093              RTS
0000168C= 53 45 4C 45 43 54 ...   1094  .MSG        DC.B    'SELECT A CSV FILE TO LOAD',0
000016A6= 2A 2E 43 53 56 00       1095  .FILTER     DC.B    '*.CSV',0
000016AC                          1096              DS.W    0
000016AC                          1097  
000016AC                          1098  ; -----------------------------------------------------------------------------
000016AC                          1099  GRDLLEFT
000016AC                          1100  ; LOADS THE LEFT PART OF THE GRID FROM A CSV FORMATTED FILE
000016AC                          1101  ; INPUT    : NONE
000016AC                          1102  ; OUTPUT   : NONE
000016AC                          1103  ; MODIFIES : NONE
000016AC                          1104  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
000016AC                          1105  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
000016AC                          1106  ; NOTE     : ALL THE ACTIVE CELLS ARE STORED AS PLAYER 1 INDEPENDLY OF THEIR
000016AC                          1107  ;            ACTUAL VALUE.
000016AC                          1108  ; -----------------------------------------------------------------------------
000016AC                          1109  
000016AC  48E7 FFFE               1110              MOVEM.L D0-D7/A0-A6,-(A7)       ; TO BE OPTIMIZED
000016B0  103C 0032               1111              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
000016B4  4E4F                    1112              TRAP    #15
000016B6  9FFC 00000200           1113              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
000016BC  103C 003A               1114              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
000016C0  4281                    1115              CLR.L   D1                      ; DISPLAY LOAD DIALOG
000016C2  43F9 0000173E           1116              LEA     .MSG,A1                 ; STANDARD MESSAGE
000016C8  45F9 0000175D           1117              LEA     .FILTER,A2              ; NO FILTER
000016CE  264F                    1118              MOVE.L  A7,A3                   ; FILE NAME BUFFER
000016D0  4253                    1119              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
000016D2  4E4F                    1120              TRAP    #15
000016D4  4A01                    1121              TST.B   D1
000016D6  6700 005A               1122              BEQ     .END                    ; IF CANCELLED, DO NOTHING
000016DA  224B                    1123              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
000016DC  103C 0033               1124              MOVE.B  #51,D0                  ; OPEN EXISTING FILE
000016E0  4E4F                    1125              TRAP    #15
000016E2  4A40                    1126              TST.W   D0                      ; CHECK ERRORS
000016E4  6600 004C               1127              BNE     .END                    ; IF ERRORS, DO NOTHING MORE
000016E8  2C4F                    1128              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
000016EA  224F                    1129              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
000016EC  41F9 00001B62           1130              LEA GRDDST, A0                  ; POINTER TO STORE PROCESS. DATA
000016F2  363C 001F               1131              MOVE.W  #GRDHEIGH-1,D3
000016F6  224E                    1132  .LOOP       MOVE.L  A6,A1
000016F8  103C 0035               1133              MOVE.B  #53,D0                  ; READ DATA TASK NUMBER
000016FC  243C 00000081           1134              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO READ
00001702  4E4F                    1135              TRAP    #15                     ; READ THE DATA
00001704  343C 003F               1136              MOVE.W  #GRDWIDTH-1,D2
00001708  1019                    1137  .COPY       MOVE.B  (A1)+,D0                ; PICK ONE LOADED CHARACTER
0000170A  0400 0030               1138              SUB.B   #'0',D0                 ; CONVERT FROM ASCII TO NUMBER
0000170E  B03C 0002               1139              CMP.B #2,D0
00001712  6600 000C               1140              BNE .CONTINUAR
00001716  10FC 0000               1141              MOVE.B #0,(A0)+
0000171A  4EF9 00001722           1142              JMP .CLEAR
00001720                          1143  .CONTINUAR            
00001720  10C0                    1144              MOVE.B  D0,(A0)+                ; STORE DATA
00001722                          1145  .CLEAR            
00001722  5289                    1146              ADDQ.L  #1,A1                   ; SKIP THE COMMA
00001724  51CA FFE2               1147              DBRA.W  D2,.COPY
00001728  51CB FFCC               1148              DBRA.W  D3,.LOOP
0000172C  103C 0038               1149              MOVE.B  #56,D0                  ; CLOSE FILE
00001730  4E4F                    1150              TRAP    #15
00001732  DFFC 00000200           1151  .END        ADD.L   #512,A7                 ; RESTORE STACK
00001738  4CDF 7FFF               1152              MOVEM.L (A7)+,D0-D7/A0-A6       ; TO BE OPTIMIZED
0000173C  4E75                    1153              RTS
0000173E= 53 45 4C 45 43 54 ...   1154  .MSG        DC.B    'SELECT A CSV FILE LEFT TO LOAD',0
0000175D= 2A 2E 43 53 56 00       1155  .FILTER     DC.B    '*.CSV',0
00001764                          1156              DS.W    0
00001764                          1157  
00001764                          1158  
00001764                          1159  
00001764                          1160  
00001764                          1161  
00001764                          1162  
00001764                          1163  
00001764                          1164  
00001764                          1165  
00001764                          1166  
00001764                          1167  
00001764                          1168  
00001764                          1169  
00001764                          1170  ; -----------------------------------------------------------------------------
00001764                          1171  GRDLRGT
00001764                          1172  ; LOADS THE RIGHT PART OF THE GRID FROM A CSV FORMATTED FILE
00001764                          1173  ; INPUT    : NONE
00001764                          1174  ; OUTPUT   : NONE
00001764                          1175  ; MODIFIES : NONE
00001764                          1176  ; NOTE     : THE LOCAL BUFFER SIZE MUST BE MAX(512,2*GRDWIDTH+1). PLEASE CHANGE
00001764                          1177  ;            IT ACCORDINGLY IF GRDWIDTH*2+1 IS LARGER THAN 512.
00001764                          1178  ; NOTE     : ALL THE ACTIVE CELLS ARE STORED AS PLAYER 2 INDEPENDLY OF THEIR
00001764                          1179  ;            ACTUAL VALUE.
00001764                          1180  ; -----------------------------------------------------------------------------
00001764                          1181  
00001764  48E7 FFFE               1182              MOVEM.L D0-D7/A0-A6,-(A7)       ; TO BE OPTIMIZED
00001768  103C 0032               1183              MOVE.B  #50,D0                  ; CLOSE ALL FILES (RECOMMENDED)
0000176C  4E4F                    1184              TRAP    #15
0000176E  9FFC 00000200           1185              SUB.L   #512,A7                 ; ROW BUFFER IN LOCAL MEMORY
00001774  103C 003A               1186              MOVE.B  #58,D0                  ; SHOW FILE DIALOG TASK
00001778  4281                    1187              CLR.L   D1                      ; DISPLAY LOAD DIALOG
0000177A  43F9 000017F6           1188              LEA     .MSG,A1                 ; STANDARD MESSAGE
00001780  45F9 00001815           1189              LEA     .FILTER,A2              ; NO FILTER
00001786  264F                    1190              MOVE.L  A7,A3                   ; FILE NAME BUFFER
00001788  4253                    1191              CLR.W   (A3)                    ; ENSURE THERE IS NO STRING
0000178A  4E4F                    1192              TRAP    #15
0000178C  4A01                    1193              TST.B   D1
0000178E  6700 005A               1194              BEQ     .END                    ; IF CANCELLED, DO NOTHING
00001792  224B                    1195              MOVE.L  A3,A1                   ; PLACE THE FILENAME INTO A1
00001794  103C 0033               1196              MOVE.B  #51,D0                  ; OPEN EXISTING FILE
00001798  4E4F                    1197              TRAP    #15
0000179A  4A40                    1198              TST.W   D0                      ; CHECK ERRORS
0000179C  6600 004C               1199              BNE     .END                    ; IF ERRORS, DO NOTHING MORE
000017A0  2C4F                    1200              MOVE.L  A7,A6                   ; PUT A6 INTO START OF BUFFER
000017A2  224F                    1201              MOVE.L  A7,A1                   ; PUT A1 INTO START OF BUFFER
000017A4  41F9 00001B62           1202              LEA GRDDST, A0                  ; POINTER TO STORE PROCESS. DATA
000017AA  363C 001F               1203              MOVE.W  #GRDHEIGH-1,D3
000017AE  224E                    1204  .LOOP       MOVE.L  A6,A1
000017B0  103C 0035               1205              MOVE.B  #53,D0                  ; READ DATA TASK NUMBER
000017B4  243C 00000081           1206              MOVE.L  #GRDWIDTH*2+1,D2        ; NUMBER OF BYTES TO READ
000017BA  4E4F                    1207              TRAP    #15                     ; READ THE DATA
000017BC  343C 003F               1208              MOVE.W  #GRDWIDTH-1,D2
000017C0  1019                    1209  .COPY       MOVE.B  (A1)+,D0                ; PICK ONE LOADED CHARACTER
000017C2  0400 0030               1210              SUB.B   #'0',D0                 ; CONVERT FROM ASCII TO NUMBER
000017C6  B03C 0001               1211              CMP.B #1,D0
000017CA  6600 000C               1212              BNE .CONTINUAR
000017CE  10FC 0000               1213              MOVE.B #0,(A0)+
000017D2  4EF9 000017DA           1214              JMP .CLEAR
000017D8                          1215  .CONTINUAR            
000017D8  10C0                    1216              MOVE.B  D0,(A0)+                ; STORE DATA
000017DA                          1217  .CLEAR            
000017DA  5289                    1218              ADDQ.L  #1,A1                   ; SKIP THE COMMA
000017DC  51CA FFE2               1219              DBRA.W  D2,.COPY
000017E0  51CB FFCC               1220              DBRA.W  D3,.LOOP
000017E4  103C 0038               1221              MOVE.B  #56,D0                  ; CLOSE FILE
000017E8  4E4F                    1222              TRAP    #15
000017EA  DFFC 00000200           1223  .END        ADD.L   #512,A7                 ; RESTORE STACK
000017F0  4CDF 7FFF               1224              MOVEM.L (A7)+,D0-D7/A0-A6       ; TO BE OPTIMIZED
000017F4  4E75                    1225              RTS
000017F6= 53 45 4C 45 43 54 ...   1226  .MSG        DC.B    'SELECT A CSV FILE LEFT TO LOAD',0
00001815= 2A 2E 43 53 56 00       1227  .FILTER     DC.B    '*.CSV',0
0000181C                          1228              DS.W    0
0000181C                          1229  
0000181C                          1230  ; -----------------------------------------------------------------------------
0000181C                          1231  GRDPLOT
0000181C                          1232  ; PLOTS THE GRID
0000181C                          1233  ; INPUT    : NONE
0000181C                          1234  ; OUTPUT   : NONE
0000181C                          1235  ; MODIFIES : NONE
0000181C                          1236  ; -----------------------------------------------------------------------------
0000181C                          1237  
0000181C                          1238  ; TODO : PLACE YOUR CODE HERE
0000181C                          1239  
0000181C  48E7 FEF0               1240   MOVEM.L D0-D6/A0-A3, -(A7)
00001820  41F9 00001B62           1241      LEA GRDDST, A0            ; A0: POINTER TO THE DATA TO WRITE
00001826  43F9 00002B66           1242      LEA GRDNPLR1, A1
0000182C  45F9 00002B68           1243      LEA GRDNPLR2, A2
00001832  4251                    1244      CLR.W (A1)
00001834  4252                    1245      CLR.W (A2)
00001836                          1246      
00001836                          1247      
00001836                          1248      ;;;;;;;;;;;;;;;;;;
00001836                          1249      
00001836                          1250      
00001836                          1251      ;GRID
00001836  3A3C 0020               1252      MOVE.W  #GRDHEIGH,D5          ; NUMBER OF ROWS
0000183A  5345                    1253      SUBQ.W #1,D5
0000183C                          1254      
0000183C  3C3C 0040               1255      MOVE.W  #GRDWIDTH,D6          ; NUMBER OF COLUMNS
00001840  5346                    1256      SUBQ.W #1,D6
00001842                          1257      
00001842                          1258      
00001842                          1259      ;GREEN PEN
00001842  103C 0050               1260      MOVE.B #80,D0
00001846  223C 00005500           1261      MOVE.L #CLRDKGRN,D1
0000184C  4E4F                    1262      TRAP #15
0000184E                          1263  
0000184E                          1264    
0000184E                          1265      ;CHANGE WIDTH OF PEN
0000184E  103C 005D               1266      MOVE.B #93,D0
00001852  123C 0002               1267      MOVE.B #2,D1
00001856  4E4F                    1268      TRAP #15
00001858                          1269      
00001858  363C 0010               1270      MOVE.W #GRDXOFF, D3     ;INITIAL POSITION GRID X
0000185C  343C 009E               1271      MOVE.W #GRDYOFF, D2     ;INITIAL POSITION GRID Y
00001860                          1272      
00001860                          1273      
00001860                          1274  .FILA:
00001860                          1275      
00001860  1E18                    1276      MOVE.B (A0)+,D7
00001862                          1277     
00001862                          1278      ;CHECK IF IS PLAYER 1'S CELL
00001862  BE7C 0001               1279      CMP #1,D7
00001866  6700 0040               1280      BEQ .PLAYER1
0000186A                          1281      ;CHECK IF IS PLAYER 2'S CELL
0000186A  BE7C 0002               1282      CMP #2,D7
0000186E  6700 005C               1283      BEQ .PLAYER2
00001872                          1284      ;NO PLAYER
00001872                          1285      
00001872                          1286      ;PAINT RECTANGLE PLAYER 1
00001872                          1287      ;FILL COLOR
00001872  103C 0051               1288      MOVE.B #81,D0
00001876  7200                    1289      MOVE.L #CLRBLACK,D1
00001878  4E4F                    1290      TRAP #15
0000187A                          1291      
0000187A                          1292      ;DRAW RECTANGLE
0000187A  103C 0057               1293      MOVE.B #87,D0
0000187E  3203                    1294      MOVE.W D3,D1
00001880  3802                    1295      MOVE.W D2,D4    
00001882                          1296      
00001882                          1297      ;STEP FORWARD ONE CELL ON A ROW
00001882  0643 000C               1298      ADD.W #GRDSZCEL,D3
00001886  0644 000C               1299      ADD.W #GRDSZCEL,D4
0000188A  4E4F                    1300      TRAP #15
0000188C                          1301      
0000188C                          1302  .LOOP_PLAYER:  
0000188C                          1303  
0000188C                          1304      
0000188C  51CE FFD2               1305      DBRA D6, .FILA
00001890                          1306      
00001890  363C 0010               1307      MOVE.W #GRDXOFF,D3            ;INITIAL POSITION GRID X  
00001894                          1308      
00001894                          1309      ;CHANGE ROW
00001894  0642 000C               1310      ADD.W #GRDSZCEL,D2              
00001898                          1311      
00001898  3C3C 0040               1312      MOVE.W  #GRDWIDTH,D6          ; NUMBER OF COLUMNS
0000189C  5346                    1313      SUBQ.W #1,D6
0000189E                          1314      
0000189E  51CD FFC0               1315      DBRA D5, .FILA
000018A2  4EF9 000018F0           1316      JMP .FINAL
000018A8                          1317  
000018A8                          1318  .PLAYER1:
000018A8                          1319  
000018A8                          1320  
000018A8                          1321      ;PAINT RECTANGLE PLAYER 1
000018A8                          1322      ;FILL COLOR
000018A8  103C 0051               1323      MOVE.B #81,D0
000018AC  223C 00FF0000           1324      MOVE.L #CLRLTBLU,D1
000018B2  4E4F                    1325      TRAP #15
000018B4                          1326      
000018B4                          1327      ;DRAW RECTANGLE
000018B4  103C 0057               1328      MOVE.B #87,D0
000018B8  3203                    1329      MOVE.W D3,D1
000018BA  3802                    1330      MOVE.W D2,D4
000018BC                          1331      
000018BC                          1332      ;STEP FORWARD ONE CELL ON A ROW
000018BC  0643 000C               1333      ADD.W #GRDSZCEL,D3
000018C0  0644 000C               1334      ADD.W #GRDSZCEL,D4
000018C4  4E4F                    1335      TRAP #15
000018C6                          1336      
000018C6                          1337      ;INCREASE PLAYER1 COUNTER
000018C6  5251                    1338      ADDQ.W #1, (A1)
000018C8  4EF8 188C               1339      JMP .LOOP_PLAYER
000018CC                          1340  
000018CC                          1341  
000018CC                          1342  .PLAYER2:
000018CC                          1343  
000018CC                          1344  
000018CC                          1345      ;PAINT RECTANGLE PLAYER 2
000018CC                          1346      ;FILL COLOR
000018CC  103C 0051               1347      MOVE.B #81,D0
000018D0  223C 000000FF           1348      MOVE.L #CLRLTRED,D1
000018D6  4E4F                    1349      TRAP #15
000018D8                          1350      
000018D8                          1351      
000018D8                          1352      ;RECTANGLE
000018D8  103C 0057               1353      MOVE.B #87,D0
000018DC  3203                    1354      MOVE.W D3,D1
000018DE  3802                    1355      MOVE.W D2,D4
000018E0                          1356      
000018E0                          1357      ;STEP FORWARD ONE CELL ON A ROW
000018E0  0643 000C               1358      ADD.W #GRDSZCEL,D3
000018E4  0644 000C               1359      ADD.W #GRDSZCEL,D4
000018E8  4E4F                    1360      TRAP #15
000018EA                          1361      
000018EA                          1362      ;INCREASE PLAYER1 COUNTER
000018EA  5252                    1363      ADDQ.W #1, (A2)
000018EC                          1364      
000018EC  4EF8 188C               1365      JMP .LOOP_PLAYER
000018F0                          1366   
000018F0                          1367            
000018F0                          1368  .FINAL:
000018F0                          1369  
000018F0                          1370      ;CONTADORES
000018F0  103C 0051               1371      MOVE.B #81,D0
000018F4  223C 00FF0000           1372      MOVE.L #CLRLTBLU,D1
000018FA  4E4F                    1373      TRAP #15
000018FC                          1374      
000018FC  103C 005F               1375      MOVE.B #95,D0     
00001900  323C 0002               1376      MOVE.W #GRDSCP1X,D1
00001904  343C 0009               1377      MOVE.W #GRDSCP1Y,D2
00001908  43F9 00002B66           1378      LEA GRDNPLR1,A1
0000190E  4E4F                    1379      TRAP #15
00001910                          1380      
00001910  103C 0051               1381      MOVE.B #81,D0
00001914  223C 000000FF           1382      MOVE.L #CLRLTRED,D1
0000191A  4E4F                    1383      TRAP #15
0000191C                          1384      
0000191C  103C 005F               1385      MOVE.B #95,D0
00001920  323C 005E               1386      MOVE.W #GRDSCP2X,D1
00001924  343C 0009               1387      MOVE.W #GRDSCP2Y,D2
00001928  43F9 00002B68           1388      LEA GRDNPLR2,A1
0000192E  4E4F                    1389      TRAP #15
00001930                          1390     
00001930  103C 0051               1391      MOVE.B #81,D0
00001934  223C 00005500           1392      MOVE.L #CLRDKGRN,D1
0000193A  4E4F                    1393      TRAP #15
0000193C                          1394      
0000193C  103C 005F               1395      MOVE.B #95,D0
00001940  323C 0030               1396      MOVE.W #GRDSCNGX,D1
00001944  343C 0009               1397      MOVE.W #GRDSCNGY,D2
00001948  43F9 00002B6A           1398      LEA GRDNGEN,A1
0000194E  4E4F                    1399      TRAP #15
00001950                          1400  
00001950  4CDF 0F7F               1401      MOVEM.L  (A7)+, D0-D6/A0-A3
00001954  4E75                    1402      RTS
00001956                          1403   
00001956                          1404   
00001956                          1405   
00001956                          1406   
00001956                          1407  
00001956                          1408  
00001956                          1409  
00001956                          1410  
00001956                          1411  
00001956                          1412  
00001956                          1413  
00001956                          1414  
00001956                          1415  
00001956                          1416  
00001956                          1417  
00001956                          1418  
00001956                          1419  
00001956                          1420  
00001956                          1421  
00001956                          1422  -------------------- end include --------------------
00001956                          1423              INCLUDE "GOL.X68"               ; GAME OF LIFE APPLICATION
00001956                          1424  ; =============================================================================
00001956                          1425  ; TITLE    : GAME OF LIFE APPLICATION
00001956                          1426  ; AUTHOR   : ANTONI BURGUERA
00001956                          1427  ; HISTORY  : 05-JULY-2021 - CREATION
00001956                          1428  ; COMMENTS : THIS IS AN APPLICATION. SO, IT IMPLEMENTS INITIALIZATION, UPDATE
00001956                          1429  ;            AND PLOT, AS WELL AS SOME AUXILIARY SUBROUTINES.
00001956                          1430  ; =============================================================================
00001956                          1431  
00001956                          1432  ; -----------------------------------------------------------------------------
00001956                          1433  GOLINIT
00001956                          1434  ; INITIALIZE GAME OF LIFE APPLICATION AS FOLLOWS:
00001956                          1435  ; * MAKES THE INTERNAL STATE TO BE "PAUSED/STOPPED"
00001956                          1436  ; * INITIALIZES THE USER INTERFACE (BY INITIALIZING THE BUTTONS LIST AND
00001956                          1437  ;   ADDING BUTTONS INTO IT)
00001956                          1438  ; * INITIALIZES THE GRID.
00001956                          1439  ; * INITIALIZES THE UTILITY CODE.
00001956                          1440  ; INPUT    : NONE
00001956                          1441  ; OUTPUT   : NONE
00001956                          1442  ; MODIFIES : NONE
00001956                          1443  ; -----------------------------------------------------------------------------
00001956  48E7 FFFE               1444              MOVEM.L D0-D7/A0-A6,-(A7)
0000195A  13FC 0000 00002B6C      1445              MOVE.B  #GOLSPAUS,(GOLSTATE)
00001962  4EB8 13A2               1446              JSR     BTLINIT
00001966  41F9 0000198C           1447              LEA     .SDBLIST,A0
0000196C  2258                    1448  .LOOP       MOVE.L  (A0)+,A1
0000196E  B3FC FFFFFFFF           1449              CMP.L   #-1,A1
00001974  6700 0008               1450              BEQ     .END
00001978  4EB8 13C2               1451              JSR     BTLADD
0000197C  60EE                    1452              BRA     .LOOP
0000197E  4EB8 143C               1453  .END        JSR     GRDINIT
00001982  4EB8 110A               1454              JSR     UTLINIT
00001986  4CDF 7FFF               1455              MOVEM.L (A7)+,D0-D7/A0-A6
0000198A  4E75                    1456              RTS
0000198C= 00001A68 00001A7A ...   1457  .SDBLIST    DC.L    GOLCLRBT,GOLRUNBT,GOLSTPBT,GOLSTEBT,GOLLLFBT,GOLLRTBT
000019A4= 00001ADC 00001AEE ...   1458              DC.L    GOLLOABT,GOLSAVBT,-1
000019B0                          1459  
000019B0                          1460  ; -----------------------------------------------------------------------------
000019B0                          1461  GOLUPD
000019B0                          1462  ; UPDATE GAME OF LIFE APPLICATION AS FOLLOWS:
000019B0                          1463  ; * UPDATES THE BUTTON LIST
000019B0                          1464  ; * EXECUTES CODE DEPENDING ON THE CURRENT APPLICATION STATE.
000019B0                          1465  ; INPUT    : NONE
000019B0                          1466  ; OUTPUT   : NONE
000019B0                          1467  ; MODIFIES : NONE
000019B0                          1468  ; -----------------------------------------------------------------------------
000019B0  48E7 C0C0               1469              MOVEM.L A0-A1/D0-D1,-(A7)
000019B4  4EB8 13EC               1470              JSR     BTLUPD
000019B8  41F9 000019D4           1471              LEA     .JMPTBL,A0
000019BE  4280                    1472              CLR.L   D0
000019C0  1039 00002B6C           1473              MOVE.B  (GOLSTATE),D0
000019C6  E508                    1474              LSL.B   #2,D0
000019C8  2070 0000               1475              MOVE.L  (A0,D0),A0
000019CC  4E90                    1476              JSR     (A0)
000019CE  4CDF 0303               1477              MOVEM.L (A7)+,A0-A1/D0-D1
000019D2  4E75                    1478              RTS
000019D4= 0000147C 000019E4       1479  .JMPTBL     DC.L    GRDMUPD,GOLDORUN
000019DC                          1480  
000019DC                          1481  ; -----------------------------------------------------------------------------
000019DC                          1482  GOLPLOT
000019DC                          1483  ; PLOTS THE APPLICATION BY CALLING BTLPLOT AND GRDPLOT
000019DC                          1484  ; INPUT    : NONE
000019DC                          1485  ; OUTPUT   : NONE
000019DC                          1486  ; MODIFIES : NONE
000019DC                          1487  ; -----------------------------------------------------------------------------
000019DC  4EB8 1414               1488              JSR     BTLPLOT
000019E0  4EF8 181C               1489              JMP     GRDPLOT
000019E4                          1490  
000019E4                          1491  ; -----------------------------------------------------------------------------
000019E4                          1492  GOLDORUN
000019E4                          1493  ; EXECUTES THE RUN STATE. IT ALSO CHECKS IF THE MAXIMUM NUMBER OF GENERATIONS
000019E4                          1494  ; IS REACHED AND, IF SO, ANNOUNCES THE WINNER.
000019E4                          1495  ; INPUT    : NONE
000019E4                          1496  ; OUTPUT   : NONE
000019E4                          1497  ; MODIFIES : NONE
000019E4                          1498  ; -----------------------------------------------------------------------------
000019E4  48E7 8040               1499              MOVEM.L D0/A1,-(A7)
000019E8  0C79 00FA 00002B6A      1500              CMP.W   #GOLMAXGN,(GRDNGEN)
000019F0  6D00 0034               1501              BLT     .DOIT
000019F4  43F9 00001A46           1502              LEA     .TIE,A1
000019FA  3039 00002B66           1503              MOVE.W  (GRDNPLR1),D0
00001A00  B079 00002B68           1504              CMP.W   (GRDNPLR2),D0
00001A06  6700 0012               1505              BEQ     .PLAYSOUND
00001A0A  43F9 00001A30           1506              LEA     .P1WINS,A1
00001A10  6E00 0008               1507              BGT     .PLAYSOUND
00001A14  43F9 00001A3B           1508              LEA     .P2WINS,A1
00001A1A  103C 0046               1509  .PLAYSOUND  MOVE.B  #70,D0
00001A1E  4E4F                    1510              TRAP    #15
00001A20  4EB9 00001A5E           1511  .NOSOUND    JSR     GOLTOPAU
00001A26  4EB8 1524               1512  .DOIT       JSR     GRDRUPD
00001A2A  4CDF 0201               1513              MOVEM.L (A7)+,D0/A1
00001A2E  4E75                    1514              RTS
00001A30= 50 31 57 49 4E 53 ...   1515  .P1WINS     DC.B    'P1WINS.WAV',0
00001A3B= 50 32 57 49 4E 53 ...   1516  .P2WINS     DC.B    'P2WINS.WAV',0
00001A46= 54 49 45 2E 57 41 ...   1517  .TIE        DC.B    'TIE.WAV',0
00001A4E                          1518              DS.W    0
00001A4E                          1519  
00001A4E                          1520  ; -----------------------------------------------------------------------------
00001A4E                          1521  GOLTORUN
00001A4E                          1522  ; SWITCHES TO RUN STATE
00001A4E                          1523  ; INPUT    : NONE
00001A4E                          1524  ; OUTPUT   : NONE
00001A4E                          1525  ; MODIFIES : NONE
00001A4E                          1526  ; -----------------------------------------------------------------------------
00001A4E  4279 00002B6A           1527              CLR.W   (GRDNGEN)               ; CLEAR GENERATIONS COUNT
00001A54  13FC 0001 00002B6C      1528              MOVE.B  #GOLSEXEC,(GOLSTATE)
00001A5C  4E75                    1529              RTS
00001A5E                          1530  
00001A5E                          1531  ; -----------------------------------------------------------------------------
00001A5E                          1532  GOLTOPAU
00001A5E                          1533  ; SWITCHES TO PAUSE STATE
00001A5E                          1534  ; INPUT    : NONE
00001A5E                          1535  ; OUTPUT   : NONE
00001A5E                          1536  ; MODIFIES : NONE
00001A5E                          1537  ; -----------------------------------------------------------------------------
00001A5E  13FC 0000 00002B6C      1538              MOVE.B  #GOLSPAUS,(GOLSTATE)
00001A66  4E75                    1539              RTS
00001A68                          1540  
00001A68                          1541  ; --- STATIC DATA -------------------------------------------------------------
00001A68                          1542  
00001A68                          1543  ; CLEAR BUTTON SDB
00001A68                          1544  
00001A68= 000A                    1545  GOLCLRBT    DC.W    BTLVEMRG                ; YTOP
00001A6A= 000A                    1546              DC.W    0*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001A6C= 0028                    1547              DC.W    BTLVERSZ                ; HEIGHT
00001A6E= 00B4                    1548              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001A70                          1549  ; TODO: PLACE THE CALLBACK HERE
00001A70                          1550              
00001A70= 0000143C                1551              DC.L   GRDINIT
00001A74                          1552              
00001A74= 43 4C 45 41 52 00       1553              DC.B    'CLEAR',0               ; TEXT
00001A7A                          1554              DS.W    0
00001A7A                          1555  
00001A7A                          1556  ; RUN BUTTON SDB
00001A7A                          1557  
00001A7A= 000A                    1558  GOLRUNBT    DC.W    BTLVEMRG                ; YTOP
00001A7C= 00D2                    1559              DC.W    1*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001A7E= 0028                    1560              DC.W    BTLVERSZ                ; HEIGHT
00001A80= 00B4                    1561              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001A82                          1562  ; TODO: PLACE THE CALLBACK HERE
00001A82= 00001A4E                1563              DC.L   GOLTORUN
00001A86= 52 55 4E 00             1564              DC.B    'RUN',0                 ; TEXT
00001A8A                          1565              DS.W    0
00001A8A                          1566  
00001A8A                          1567  ; STOP BUTTON SDB
00001A8A                          1568  
00001A8A= 000A                    1569  GOLSTPBT    DC.W    BTLVEMRG                ; YTOP
00001A8C= 019A                    1570              DC.W    2*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001A8E= 0028                    1571              DC.W    BTLVERSZ                ; HEIGHT
00001A90= 00B4                    1572              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001A92                          1573  ; TODO: PLACE THE CALLBACK HERE
00001A92= 00001A5E                1574              DC.L  GOLTOPAU
00001A96= 53 54 4F 50 00          1575              DC.B    'STOP',0                ; TEXT
00001A9C                          1576              DS.W    0
00001A9C                          1577  
00001A9C                          1578  ; STEP BUTTON SDB
00001A9C                          1579  
00001A9C= 000A                    1580  GOLSTEBT    DC.W    BTLVEMRG                ; YTOP
00001A9E= 0262                    1581              DC.W    3*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001AA0= 0028                    1582              DC.W    BTLVERSZ                ; HEIGHT
00001AA2= 00B4                    1583              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001AA4                          1584  ; TODO: PLACE THE CALLBACK HEREÇ
00001AA4= 000019E4                1585              DC.L GOLDORUN
00001AA8= 53 54 45 50 00          1586              DC.B    'STEP',0                ; TEXT
00001AAE                          1587              DS.W    0
00001AAE                          1588  
00001AAE                          1589  ; LOAD LEFT BUTTON SDB
00001AAE                          1590  
00001AAE= 003C                    1591  GOLLLFBT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
00001AB0= 000A                    1592              DC.W    0*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001AB2= 0028                    1593              DC.W    BTLVERSZ                ; HEIGHT
00001AB4= 00B4                    1594              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001AB6                          1595  ; TODO: PLACE THE CALLBACK HERE
00001AB6= 000016AC                1596              DC.L GRDLLEFT
00001ABA= 4C 4F 41 44 20 4C ...   1597              DC.B    'LOAD LEFT',0           ; TEXT
00001AC4                          1598              DS.W    0
00001AC4                          1599  
00001AC4                          1600  ; LOAD RIGHT BUTTON SDB
00001AC4                          1601  
00001AC4= 003C                    1602  GOLLRTBT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
00001AC6= 00D2                    1603              DC.W    1*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001AC8= 0028                    1604              DC.W    BTLVERSZ                ; HEIGHT
00001ACA= 00B4                    1605              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001ACC                          1606  ; TODO: PLACE THE CALLBACK HERE
00001ACC= 00001764                1607              DC.L   GRDLRGT
00001AD0= 4C 4F 41 44 20 52 ...   1608              DC.B    'LOAD RIGHT',0          ; TEXT
00001ADC                          1609              DS.W    0
00001ADC                          1610  
00001ADC                          1611  ; LOAD ALL BUTTON SDB
00001ADC                          1612  
00001ADC= 003C                    1613  GOLLOABT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
00001ADE= 019A                    1614              DC.W    2*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001AE0= 0028                    1615              DC.W    BTLVERSZ                ; HEIGHT
00001AE2= 00B4                    1616              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001AE4                          1617  ; TODO: PLACE THE CALLBACK HERE
00001AE4= 4C 4F 41 44 20 41 ...   1618              DC.B    'LOAD ALL',0            ; TEXT
00001AEE                          1619              DS.W    0
00001AEE                          1620  
00001AEE                          1621  ; SAVE BUTTON SDB
00001AEE                          1622  
00001AEE= 003C                    1623  GOLSAVBT    DC.W    2*BTLVEMRG+BTLVERSZ     ; YTOP
00001AF0= 0262                    1624              DC.W    3*(SCRWIDTH/4)+BTLHOMRG ; XLEFT
00001AF2= 0028                    1625              DC.W    BTLVERSZ                ; HEIGHT
00001AF4= 00B4                    1626              DC.W    SCRWIDTH/4-2*BTLHOMRG   ; WIDTH
00001AF6                          1627  ; TODO: PLACE THE CALLBACK HERE
00001AF6= 00001560                1628              DC.L    GRDSAVE
00001AFA= 53 41 56 45 00          1629              DC.B    'SAVE',0          ; TEXT
00001B00                          1630              DS.W    0
00001B00                          1631  
00001B00                          1632  
00001B00                          1633  
00001B00                          1634  -------------------- end include --------------------
00001B00                          1635  
00001B00                          1636  ; --- INITIALIZE --------------------------------------------------------------
00001B00                          1637  
00001B00  4EB8 1000               1638  START       JSR     SYSINIT                 ; INITIALIZE SYSTEM CODE
00001B04  4EB8 1956               1639              JSR     GOLINIT                 ; INITIALIZE GAME OF LIFE
00001B08                          1640  
00001B08                          1641  ; --- UPDATE ------------------------------------------------------------------
00001B08                          1642  
00001B08  4E41                    1643  .LOOP       TRAP    #MOUTRAP                ; READ MOUSE
00001B0A  4EB8 19B0               1644              JSR     GOLUPD                  ; UPDATE APPLICATION
00001B0E                          1645  
00001B0E                          1646  ; --- PLOT --------------------------------------------------------------------
00001B0E                          1647  
00001B0E  4EB8 19DC               1648              JSR     GOLPLOT                 ; PLOT APPLICATION
00001B12  4E40                    1649              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001B14  60F2                    1650              BRA     .LOOP
00001B16  FFFF FFFF               1651              SIMHALT
00001B1A                          1652  
00001B1A                          1653  ; --- VARIABLES ---------------------------------------------------------------
00001B1A                          1654  
00001B1A                          1655              INCLUDE "SYSVAR.X68"            ; SYSTEM VARIABLES
00001B1A                          1656  ; =============================================================================
00001B1A                          1657  ; TITLE    : SYSTEM VARS
00001B1A                          1658  ; AUTHOR   : ANTONI BURGUERA
00001B1A                          1659  ; HISTORY  : 05-JULY-2021 - CREATION
00001B1A                          1660  ; COMMENTS : * ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
00001B1A                          1661  ;              THEY MUST NOT BE IN PROTECTED MEMORY.
00001B1A                          1662  ;
00001B1A                          1663  ;            * SINCE SOME SUBROUTINES TAKE ADVANTAGE OF THE ORDER IN WHICH
00001B1A                          1664  ;              THE VARIABLES ARE IN MEMORY, THEIR ORDER SHOULD NOT BE ALTERED.
00001B1A                          1665  ; =============================================================================
00001B1A                          1666  
00001B1A                          1667  ; --- MOUSE RELATED VARIABLES -------------------------------------------------
00001B1A                          1668  
00001B1A                          1669  MOUY        DS.W    1                       ; MOUSE Y COORDINATE
00001B1C                          1670  MOUX        DS.W    1                       ; MOUSE X COORDINATE
00001B1E                          1671  MOUVAL      DS.B    1                       ; CURRENT MOUSE BUTTON STATUS
00001B1F                          1672  MOUEDGE     DS.B    1                       ; RISING EDGES IN MOUVAL
00001B20                          1673              DS.W    0
00001B20                          1674  -------------------- end include --------------------
00001B20                          1675              INCLUDE "VAR.X68"               ; USER VARIABLES
00001B20                          1676  ; =============================================================================
00001B20                          1677  ; TITLE    : USER VARS
00001B20                          1678  ; AUTHOR   : ANTONI BURGUERA
00001B20                          1679  ; HISTORY  : 05-JULY-2021 - CREATION
00001B20                          1680  ; COMMENTS : SEE THE CORRESPONDING FILES (UTIL.X68, BTNLIST.X68, GRID.X68 OR
00001B20                          1681  ;            GOL.X68) TO LEARN ABOUT THE MEANING OF THESE VARIABLES.
00001B20                          1682  ; =============================================================================
00001B20                          1683  
00001B20                          1684  ; --- UTILITY VARS ------------------------------------------------------------
00001B20                          1685  
00001B20                          1686  UTLRNDIX    DS.B    1                       ; RANDOM GENERATOR INDEX
00001B22                          1687              DS.W    0
00001B22                          1688  
00001B22                          1689  ; --- BUTTON LIST -------------------------------------------------------------
00001B22                          1690  
00001B22                          1691  BTLDATA     DS.B    BTLMXVDB*BTNSZVDB       ; BUTTONS VDB STORAGE
00001B5E                          1692              DS.W    0
00001B5E                          1693  
00001B5E                          1694  ; --- GRID --------------------------------------------------------------------
00001B5E                          1695  
00001B5E                          1696  GRDSRC      DS.L    1                       ; SOURCE MATRIX POINTER
00001B62                          1697  GRDDST      DS.L    1                       ; DESTINATION MATRIX POINTER
00001B66                          1698  GRDMATR0    DS.B    GRDWIDTH*GRDHEIGH       ; ONE OF THE GRIDS...
00002366                          1699  GRDMATR1    DS.B    GRDWIDTH*GRDHEIGH       ; THE OTHER GRID
00002B66                          1700  GRDNPLR1    DS.W    1                       ; NUMBER OF PLAYER 1 CELLS
00002B68                          1701  GRDNPLR2    DS.W    1                       ; NUMBER OF PLAYER 2 CELLS
00002B6A                          1702  GRDNGEN     DS.W    1                       ; NUMOER OF GENERATIONS
00002B6C                          1703  
00002B6C                          1704  ; --- APPLICATION -------------------------------------------------------------
00002B6C                          1705  
00002B6C                          1706  GOLSTATE    DS.B    1                       ; APPLICATION STATE
00002B6E                          1707              DS.W    0
00002B6E                          1708  -------------------- end include --------------------
00002B6E                          1709  
00002B6E                          1710              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
BIT_C               12F8
BIT_I               12C4
BIT_P               12DE
BTLADD              13C2
BTLADD:END          13E0
BTLADD:FOUND        13E6
BTLADD:LOOP         13D0
BTLCLEAR            13A2
BTLDATA             1B22
BTLHOMRG            A
BTLINIT             13A2
BTLINIT:LOOP        13B0
BTLMXVDB            A
BTLPLOT             1414
BTLPLOT:FIN         1436
BTLPLOT:LOOP        1422
BTLUPD              13EC
BTLUPD:DONE         140E
BTLUPD:LOOP         13FA
BTLVEMRG            A
BTLVERSZ            28
BTNINIT             1242
BTNPENCL            5500
BTNPENWD            4
BTNPLOT             130A
BTNPRSCL            6600
BTNSELCL            AA00
BTNSZVDB            6
BTNUPD              124A
CHRHEIGH            10
CHRSHHEI            4
CHRSHWID            3
CHRWIDTH            8
CLRBLACK            0
CLRDKGRN            5500
CLRLTBLU            FF0000
CLRLTGRN            AA00
CLRLTRED            FF
CLRMDGRN            6600
CLRWHITE            FFFFFF
FINAL               1304
FINAL1              136A
GOLCLRBT            1A68
GOLDORUN            19E4
GOLDORUN:DOIT       1A26
GOLDORUN:NOSOUND    1A20
GOLDORUN:P1WINS     1A30
GOLDORUN:P2WINS     1A3B
GOLDORUN:PLAYSOUND  1A1A
GOLDORUN:TIE        1A46
GOLINIT             1956
GOLINIT:END         197E
GOLINIT:LOOP        196C
GOLINIT:SDBLIST     198C
GOLLLFBT            1AAE
GOLLOABT            1ADC
GOLLRTBT            1AC4
GOLMAXGN            FA
GOLPLOT             19DC
GOLRUNBT            1A7A
GOLSAVBT            1AEE
GOLSEXEC            1
GOLSPAUS            0
GOLSTATE            2B6C
GOLSTEBT            1A9C
GOLSTPBT            1A8A
GOLTOPAU            1A5E
GOLTORUN            1A4E
GOLUPD              19B0
GOLUPD:JMPTBL       19D4
GRDCOLP1            FF0000
GRDCOLP2            FF
GRDDST              1B62
GRDHEIGH            20
GRDINIT             143C
GRDINIT:LOOP        1470
GRDLLEFT            16AC
GRDLLEFT:CLEAR      1722
GRDLLEFT:CONTINUAR  1720
GRDLLEFT:COPY       1708
GRDLLEFT:END        1732
GRDLLEFT:FILTER     175D
GRDLLEFT:LOOP       16F6
GRDLLEFT:MSG        173E
GRDLOAD             160C
GRDLOAD:COPY        1668
GRDLOAD:END         1680
GRDLOAD:FILTER      16A6
GRDLOAD:LOOP        1656
GRDLOAD:MSG         168C
GRDLRGT             1764
GRDLRGT:CLEAR       17DA
GRDLRGT:CONTINUAR   17D8
GRDLRGT:COPY        17C0
GRDLRGT:END         17EA
GRDLRGT:FILTER      1815
GRDLRGT:LOOP        17AE
GRDLRGT:MSG         17F6
GRDMATR0            1B66
GRDMATR1            2366
GRDMSHEI            1F
GRDMSWID            3F
GRDMUPD             147C
GRDMUPD:FINAL       151E
GRDMUPD:P1          1506
GRDMUPD:R_GRID      151A
GRDNGEN             2B6A
GRDNPLR1            2B66
GRDNPLR2            2B68
GRDPLOT             181C
GRDPLOT:FILA        1860
GRDPLOT:FINAL       18F0
GRDPLOT:LOOP_PLAYER  188C
GRDPLOT:PLAYER1     18A8
GRDPLOT:PLAYER2     18CC
GRDPXHEI            180
GRDPXWID            300
GRDRUPD             1524
GRDRUPD:BUCLE       155A
GRDRUPD:FINAL       155A
GRDSAVE             1560
GRDSAVE:END         15E0
GRDSAVE:FILTER      1606
GRDSAVE:LOOP        15AE
GRDSAVE:LOOPY       15AA
GRDSAVE:MSG         15EC
GRDSCNGX            30
GRDSCNGY            9
GRDSCP1X            2
GRDSCP1Y            9
GRDSCP2X            5E
GRDSCP2Y            9
GRDSHHEI            5
GRDSHWID            6
GRDSRC              1B5E
GRDSZCEL            C
GRDVEMRG            6E
GRDWIDTH            40
GRDXOFF             10
GRDYOFF             9E
INSIDE              1336
IN_X                128E
MAYOR_X             1274
MAYOR_Y             12AA
MOUBITLF            0
MOUBITMD            2
MOUBITRT            1
MOUEDGE             1B1F
MOUINIT             102A
MOUMSKLF            1
MOUMSKMD            4
MOUMSKRT            2
MOUREAD             1058
MOUREAD:CERO        108E
MOUREAD:DOS         10AA
MOUREAD:END         10B2
MOUREAD:UNO         109C
MOUTRAP             1
MOUVAL              1B1E
MOUX                1B1C
MOUY                1B1A
NOT_2048            7FF
NOT_32              3F
NOT_64              7F
OUT                 1362
PRESSED             1350
SCRHEIGH            258
SCRINIT             10B8
SCRTRAP             0
SCRUPD              10F0
SCRWIDTH            320
START               1B00
START:LOOP          1B08
SYSINIT             1000
UTLINIT             110A
UTLRAND             1124
UTLRAND:RANDVEC     1142
UTLRNDIX            1B20
UTLSTRLN            1112
UTLSTRLN:END        1120
UTLSTRLN:LOOP       1116
